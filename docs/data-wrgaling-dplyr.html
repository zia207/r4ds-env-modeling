<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science with R For Envrionmental Modeling – data-wrgaling-dplyr</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Data Science with R For Envrionmental Modeling</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/zia207"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="./linkedin.com/in/zia-ahmed207"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Home</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting-started-r.html" class="sidebar-item-text sidebar-link">Getting Started with R</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Basic R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./download-install-r.html" class="sidebar-item-text sidebar-link">Download and Installation R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction-to-r.html" class="sidebar-item-text sidebar-link">Introduction to use R</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-export-import.html" class="sidebar-item-text sidebar-link">Data export/import to/from R</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Data Wragling with R</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrgaling-basic.html" class="sidebar-item-text sidebar-link">Introduction to Data Wragling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrgaling-dplyr.html" class="sidebar-item-text sidebar-link active">Data Wrangling with dplyr and tidyr</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-wrgaling-janitor.html" class="sidebar-item-text sidebar-link">Data Wrangling with janitor</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#data-wrangling-with-dplyr-and-tidyr" id="toc-data-wrangling-with-dplyr-and-tidyr" class="nav-link active" data-scroll-target="#data-wrangling-with-dplyr-and-tidyr">Data Wrangling with dplyr and tidyr</a>
  <ul>
  <li><a href="#tidyr---package" id="toc-tidyr---package" class="nav-link" data-scroll-target="#tidyr---package"><strong>tidyr - Package</strong></a></li>
  <li><a href="#dplyr---package" id="toc-dplyr---package" class="nav-link" data-scroll-target="#dplyr---package"><strong>dplyr - Package</strong></a>
  <ul class="collapse">
  <li><a href="#cheat-sheet" id="toc-cheat-sheet" class="nav-link" data-scroll-target="#cheat-sheet">Cheat-sheet</a></li>
  </ul></li>
  <li><a href="#install-tidyverse" id="toc-install-tidyverse" class="nav-link" data-scroll-target="#install-tidyverse">Install tidyverse</a></li>
  <li><a href="#load-package" id="toc-load-package" class="nav-link" data-scroll-target="#load-package">Load Package</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#pipe-operator" id="toc-pipe-operator" class="nav-link" data-scroll-target="#pipe-operator">Pipe Operator</a></li>
  <li><a href="#some-important-functions" id="toc-some-important-functions" class="nav-link" data-scroll-target="#some-important-functions">Some Important Functions</a>
  <ul class="collapse">
  <li><a href="#join" id="toc-join" class="nav-link" data-scroll-target="#join">Join</a></li>
  <li><a href="#relocate" id="toc-relocate" class="nav-link" data-scroll-target="#relocate">Relocate</a></li>
  <li><a href="#rename" id="toc-rename" class="nav-link" data-scroll-target="#rename">Rename</a></li>
  <li><a href="#pipe-join-relocate-and-rename-functions" id="toc-pipe-join-relocate-and-rename-functions" class="nav-link" data-scroll-target="#pipe-join-relocate-and-rename-functions">Pipe Join, Relocate and Rename functions</a></li>
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select">Select</a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter">Filter</a></li>
  <li><a href="#summarize" id="toc-summarize" class="nav-link" data-scroll-target="#summarize">Summarize</a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate">Mutate</a></li>
  <li><a href="#group-by" id="toc-group-by" class="nav-link" data-scroll-target="#group-by">Group by</a></li>
  <li><a href="#pivoting-data-frame" id="toc-pivoting-data-frame" class="nav-link" data-scroll-target="#pivoting-data-frame">Pivoting Data-frame</a></li>
  </ul></li>
  <li><a href="#cleaning-a-messy-data" id="toc-cleaning-a-messy-data" class="nav-link" data-scroll-target="#cleaning-a-messy-data">Cleaning a messy data</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a>
  <ul class="collapse">
  <li><a href="#required-r-package" id="toc-required-r-package" class="nav-link" data-scroll-target="#required-r-package">Required R-Package</a></li>
  <li><a href="#data-1" id="toc-data-1" class="nav-link" data-scroll-target="#data-1">Data</a></li>
  <li><a href="#tasks" id="toc-tasks" class="nav-link" data-scroll-target="#tasks">Tasks</a></li>
  </ul></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further Reading</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">



<section id="data-wrangling-with-dplyr-and-tidyr" class="level1 unnumbered">
<h1 class="unnumbered">Data Wrangling with dplyr and tidyr</h1>
<p>In section you will learn you to wrangle data with two popular R-packages <strong>tidyr</strong> and <strong>dplyr</strong> and both are come with <a href="https://www.tidyverse.org/">tidyverse</a>, an collection of several R packages designed for data science.</p>
<section id="tidyr---package" class="level3">
<h3 class="anchored" data-anchor-id="tidyr---package"><strong>tidyr - Package</strong></h3>
<p><img src="Image/tidyR.png" class="img-fluid" width="174"></p>
<p><a href="https://tidyr.tidyverse.org/">tidyr</a> helps to create tidy data that enables you to work with <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidy data</a> formats which are easy to manipulate, model and visualize, and have a specific structure. It follows a set of rules for organizing variables, values, and observations into tables, with each column representing a variable and each row representing an observation. Tidy data makes it easier to perform data analysis and visualization and is the preferred format for many data analysis tools and techniques.</p>
<p><strong>tidyr</strong> functions fall into five main categories:</p>
<ul>
<li><p><strong>Pivotting</strong> which converts between long(<strong>pivot_longer()</strong>) and wide forms (<strong>pivot_wider()</strong>), replacing</p></li>
<li><p><strong>Rectangling</strong>, which turns deeply nested lists (as from JSON) into tidy tibbles.</p></li>
<li><p><strong>Nesting</strong> converts grouped data to a form where each group becomes a single row containing a nested data frame</p></li>
<li><p><strong>Splitting and combining character columns</strong>. Use <strong>separate()</strong> and <strong>extract()</strong> to pull a single character column into multiple columns;</p></li>
<li><p>Make implicit missing values explicit with <strong>complete()</strong>; make explicit missing values implicit with <strong>drop_na()</strong>; replace missing values with next/previous value with <strong>fill()</strong>, or a known value with <strong>replace_na()</strong>.</p></li>
</ul>
</section>
<section id="dplyr---package" class="level3">
<h3 class="anchored" data-anchor-id="dplyr---package"><strong>dplyr - Package</strong></h3>
<p><img src="Image/dplyR.png" class="img-fluid" width="192"></p>
<p><a href="https://dplyr.tidyverse.org/">dplyr</a> is part of a larger [tidyverse]( https://www.tidyverse.org/. It provides a grammar for data manipulation and a set of functions to clean, process, and aggregate data efficiently. Some of the key features of dplyr include:</p>
<p>A <strong>tibble</strong> data structure, which is similar to a data frame but is designed to be more efficient and easier to work with. A set of verbs for data manipulation, including <strong>filter()</strong> for subsetting rows, <strong>arrange()</strong> for sorting rows, <strong>select()</strong> for selecting columns, <strong>mutate()</strong> for adding new columns, and <strong>summarize()</strong> for aggregating data. A chainable syntax with <strong>pipe (%&gt;%)</strong> that makes it easy to perform multiple operations in a single line of code.Support for working with remote data sources, including databases and big data systems. Overall, dplyr is a popular and widely used package for data manipulation in R and is known for its simplicity and ease of use.</p>
<p>In addition to data frames/tibbles, dplyr makes working with following packages:</p>
<p><a href="https://dtplyr.tidyverse.org/"><strong>dtplyr</strong></a>: for large, in-memory datasets. Translates your dplyr code to high performance data.table code.</p>
<p><a href="https://dbplyr.tidyverse.org/"><strong>dbplyr</strong></a>: for data stored in a relational database. Translates your dplyr code to SQL.</p>
<p><a href="https://spark.rstudio.com/"><strong>sparklyr</strong></a>: for very large datasets stored in Apache Spark.</p>
<section id="cheat-sheet" class="level4">
<h4 class="anchored" data-anchor-id="cheat-sheet">Cheat-sheet</h4>
<p>Here below data Wrangling with <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">dplyr and tidyr Cheat Sheets</a>:</p>
<div id="fig-dplyr_tidyr_01" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Data Wragling with dplyrand tidyr Cheat sheet-2</figcaption><p></p>
<p><img src="Image/data_wragling cheat_sheet_01.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p><img src="Image/data_wragling cheat_sheet_02.png" class="img-fluid" alt="Data Wragling with dplyrand tidyr Cheat sheet-1">{fig-dplyr_tidyr_02}</p>
<p>In addition to tidyr, and dplyr, there are five packages (including stringr and forcats) which are designed to work with specific types of data:</p>
<ul>
<li><p><strong>lubridate</strong> for dates and date-times.</p></li>
<li><p><strong>hms</strong> for time-of-day values.</p></li>
<li><p><strong>blob</strong> for storing blob (binary) data</p></li>
</ul>
</section>
</section>
<section id="install-tidyverse" class="level3">
<h3 class="anchored" data-anchor-id="install-tidyverse">Install tidyverse</h3>
<p>You can install the tidyverse with a following line of code:</p>
<blockquote class="blockquote">
<p>install.packages(“tidyverse”)</p>
</blockquote>
</section>
<section id="load-package" class="level3">
<h3 class="anchored" data-anchor-id="load-package">Load Package</h3>
<div class="cell" title="Load tidyverse">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<p>In this exercise we will use following CSV files:</p>
<ol type="1">
<li><p><a href="https://www.dropbox.com/s/w3it6xg8cji18x6/usa_division.csv?dl=0">usa_division.csv</a>: USA division names with IDs</p></li>
<li><p><a href="https://www.dropbox.com/s/s2xdkji4eyknmoz/usa_state.csv?dl=0">usa_state.csv</a>: USA State names with ID and division ID.</p></li>
<li><p><a href="https://www.dropbox.com/s/9al1v7faxy8w092/usa_corn_production.csv?dl=0">usa_corn_production.csv</a> USA grain crop production by state from 2012-2022</p></li>
<li><p><a href="https://www.dropbox.com/s/9ikm5yct36oflei/gp_soil_data.csv?dl=0">gp_soil_data.csv</a>: Soil carbon with co-variate from four states in the Greatplain region in the USA</p></li>
<li><p><a href="https://www.dropbox.com/s/db4lxfvb40rx4sx/usa_geochemical_raw.csv?dl=0">usa_geochemical_raw.csv</a>: Soil geochemical data for the USA, but cleaned</p></li>
</ol>
<p>We will use <strong>read_csv()</strong> function of <strong>readr</strong> package to import data as a <strong>Tidy</strong> data.</p>
<div class="cell" title="Load Data">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data folder</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dataFolder<span class="ot">&lt;-</span><span class="st">"E:/Dropbox/GitHub/Data/USA/"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>div<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_division.csv"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>state<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_state.csv"</span>))</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>corn<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_corn_production.csv"</span>))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>soil<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"gp_soil_data.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pipe-operator" class="level3">
<h3 class="anchored" data-anchor-id="pipe-operator">Pipe Operator</h3>
<p>Before starting this tutorial, I like to brief you about the <strong>Pipe Operator</strong>. This is the most important operator for data wrangling in R. The pipe operator, written as <strong>%&gt;%</strong>, has been a longstanding feature of the <strong>magrittr</strong> package for R. It takes the output of one function and passes it into another function as an argument. This allows us to link a sequence of analysis steps. In this tutorial, you can see exactly how this works in a real example. (Source:https://towardsdatascience.com/an-introduction-to-the-pipe-in-r-823090760d64)</p>
</section>
<section id="some-important-functions" class="level3">
<h3 class="anchored" data-anchor-id="some-important-functions">Some Important Functions</h3>
<section id="join" class="level4">
<h4 class="anchored" data-anchor-id="join">Join</h4>
<p>In R we use <strong>base::merge()</strong> function to merge two dataframes. This function is present inside <strong>join()</strong> function of dplyr package. The most important condition for joining two dataframes is that the column type should be the same of “key” variable by the merging happens. Types of <strong>base::merge()</strong> and several <strong>join()</strong> function of dplyr available in R are:</p>
<p><img src="Image/join_functions.png" class="img-fluid" alt="Join function of dplyr">{fig-dplyr_join}</p>
<p><strong>inner_join()</strong> is a function in the <strong>dplyr</strong> library that performs an inner join on two data frames. An inner join returns only the rows that have matching values in both data frames. If there is no match in one of the data frames for a row in the other data frame, the result will not contain that row.</p>
<blockquote class="blockquote">
<p>inner_join(x, y, …..)</p>
</blockquote>
<p>We will join state, division and USA corn production data one by one e using <em>inner_join</em>()* function;</p>
<div class="cell" title="inner_join-1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>corn_state <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" title="inner_join-2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>corn_state_div <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn_state, div)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can run multiple <strong>inner_join()</strong> functions in a series with pipe <strong>%&gt;%</strong> function:</p>
<div class="cell" title="inner_join with pipe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mf.usa <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">inner_join</span>(div) <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 465
Columns: 6
$ STATE_ID      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4,…
$ YEAR          &lt;dbl&gt; 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 20…
$ MT            &lt;dbl&gt; 734352.8, 1101529.2, 1151061.8, 914829.3, 960170.7, 9968…
$ STATE_NAME    &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "…
$ DIVISION_ID   &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4,…
$ DIVISION_NAME &lt;chr&gt; "East South Central", "East South Central", "East South …</code></pre>
</div>
</div>
</section>
<section id="relocate" class="level4">
<h4 class="anchored" data-anchor-id="relocate">Relocate</h4>
<p>Now we will will organize DIVISION_FIPS, DIVISION_NAME, STATE_FIPS, STATE_NAME, DIVISION_NAME, YEAR, MT will use <strong>relocate()</strong> function:</p>
<blockquote class="blockquote">
<p>relocate(.data, …, .before = NULL, .after = NULL)</p>
</blockquote>
<div class="cell" title="relocate()">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mf.usa<span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">relocate</span>(mf.usa, DIVISION_ID, DIVISION_NAME, STATE_ID,   STATE_NAME, YEAR, MT,  </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.after =</span>  DIVISION_ID) </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mf.usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  DIVISION_ID DIVISION_NAME      STATE_ID STATE_NAME  YEAR       MT
        &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1           2 East South Central        1 Alabama     2012  734353.
2           2 East South Central        1 Alabama     2013 1101529.
3           2 East South Central        1 Alabama     2014 1151062.
4           2 East South Central        1 Alabama     2015  914829.
5           2 East South Central        1 Alabama     2016  960171.
6           2 East South Central        1 Alabama     2017  996876.</code></pre>
</div>
</div>
<p>Now explore regions names with <strong>levels()</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mf.usa<span class="sc">$</span>DIVISION_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "East North Central" "East South Central" "Middle Atlantic"   
[4] "Mountain"           "New England"        "Pacific"           
[7] "South Atlantic"     "West North Central" "West South Central"</code></pre>
</div>
</div>
</section>
<section id="rename" class="level4">
<h4 class="anchored" data-anchor-id="rename">Rename</h4>
<p>The <strong>rename()</strong> function can be used to rename variables. We will rename STAT_ID to SATE_FIPS.</p>
<blockquote class="blockquote">
<p>rename_with(.data, … .cols = …)</p>
</blockquote>
<div class="cell" title="rename()">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.usa <span class="ot">&lt;-</span> mf.usa <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"STATE_FIPS"</span> <span class="ot">=</span> <span class="st">"STATE_ID"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.usa)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DIVISION_ID"   "DIVISION_NAME" "STATE_FIPS"    "STATE_NAME"   
[5] "YEAR"          "MT"           </code></pre>
</div>
</div>
</section>
<section id="pipe-join-relocate-and-rename-functions" class="level4">
<h4 class="anchored" data-anchor-id="pipe-join-relocate-and-rename-functions">Pipe Join, Relocate and Rename functions</h4>
<p>We can also all together inner_join(), relocate(), and rename() in a single line with pipe:</p>
<div class="cell" title="inner_join, relocate, rename()">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">inner_join</span>(div) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">relocate</span>(DIVISION_ID, DIVISION_NAME, STATE_ID,   STATE_NAME, YEAR, MT,  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.after =</span>  DIVISION_ID) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"STATE_FIPS"</span> <span class="ot">=</span> <span class="st">"STATE_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 465
Columns: 6
$ DIVISION_ID   &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4,…
$ DIVISION_NAME &lt;chr&gt; "East South Central", "East South Central", "East South …
$ STATE_FIPS    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4,…
$ STATE_NAME    &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "…
$ YEAR          &lt;dbl&gt; 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 20…
$ MT            &lt;dbl&gt; 734352.8, 1101529.2, 1151061.8, 914829.3, 960170.7, 9968…</code></pre>
</div>
</div>
</section>
<section id="select" class="level4">
<h4 class="anchored" data-anchor-id="select">Select</h4>
<p><strong>dplyr::select()</strong> is used to extract a subset of columns from a data frame. It selects specific columns by name or by position. It is part of the dplyr package, which provides a set of functions that perform common data manipulation tasks efficiently and effectively.</p>
<blockquote class="blockquote">
<p>select(.data, …)</p>
</blockquote>
<p>Now we will use select() to create a dataframe with state names, year and production</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.state <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span>(STATE_NAME, YEAR,  MT,) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 465
Columns: 3
$ STATE_NAME &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "Ala…
$ YEAR       &lt;dbl&gt; 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021,…
$ MT         &lt;dbl&gt; 734352.8, 1101529.2, 1151061.8, 914829.3, 960170.7, 996875.…</code></pre>
</div>
</div>
</section>
<section id="filter" class="level4">
<h4 class="anchored" data-anchor-id="filter">Filter</h4>
<p>The <strong>filter()</strong> function in <strong>dplyr</strong> is used to subset a data frame based on some condition(s) specified in the filter argument. The syntax for using filter is:</p>
<blockquote class="blockquote">
<p>filter(df, condition1, condition2, …)</p>
</blockquote>
<p>We will use <strong>filter()</strong> to extract data only for northeast regions (single criteria) from us.df. This code will return a filtered data frame containing only the rows where the DIVISION_NAME column is equal to “East North Central”.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.01</span><span class="ot">&lt;-</span>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"East North Central"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.01</span><span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Illinois"  "Indiana"   "Michigan"  "Ohio"      "Wisconsin"</code></pre>
</div>
</div>
<p>Filtering by multiple criteria within a single logical expression - select data from East North Central, South Central and Middle Atlantic Division</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.02</span><span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"East North Central"</span>,<span class="st">"East South Central"</span>, <span class="st">"Middle Atlantic"</span>)) </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.02</span><span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Alabama"      "Illinois"     "Indiana"      "Kentucky"     "Michigan"    
 [6] "Mississippi"  "New Jersey"   "New York"     "Ohio"         "Pennsylvania"
[11] "Tennessee"    "Wisconsin"   </code></pre>
</div>
</div>
<p>or we can use <strong>|</strong> which represents <strong>OR</strong> in the logical condition, any of the two conditions.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.03</span><span class="ot">&lt;-</span> df.usa <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"East North Central"</span> <span class="sc">|</span> DIVISION_NAME <span class="sc">==</span> <span class="st">"Middle Atlantic"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.03</span><span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Illinois"     "Indiana"      "Michigan"     "New Jersey"   "New York"    
[6] "Ohio"         "Pennsylvania" "Wisconsin"   </code></pre>
</div>
</div>
<p>Following filter create a files for the Middle Atlantic Division only with New York state.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df.ny<span class="ot">&lt;-</span>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"Middle Atlantic"</span> <span class="sc">&amp;</span> STATE_NAME <span class="sc">==</span> <span class="st">"New York"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df.ny)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  DIVISION_ID DIVISION_NAME   STATE_FIPS STATE_NAME  YEAR       MT
        &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1           3 Middle Atlantic         36 New York    2012 2314570.
2           3 Middle Atlantic         36 New York    2013 2401189.
3           3 Middle Atlantic         36 New York    2014 2556391 
4           3 Middle Atlantic         36 New York    2015 2143111.
5           3 Middle Atlantic         36 New York    2016 1867761.
6           3 Middle Atlantic         36 New York    2017 1983464.</code></pre>
</div>
</div>
<p>Following filters will select State where corn production (MT) is greater than the global average of production</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mean.prod <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(MT <span class="sc">&gt;</span> <span class="fu">mean</span>(MT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mean.prod<span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Illinois"     "Indiana"      "Iowa"         "Kansas"       "Michigan"    
 [6] "Minnesota"    "Missouri"     "Nebraska"     "North Dakota" "Ohio"        
[11] "South Dakota" "Wisconsin"   </code></pre>
</div>
</div>
<p>We use will <strong>&amp;</strong> in the following filters to select states or rows where <code>MT</code> is greater than the global average of for the year 2017</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mean.prod<span class="fl">.2017</span> <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(MT <span class="sc">&gt;</span> <span class="fu">mean</span>(MT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> YEAR <span class="sc">==</span><span class="dv">2017</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mean.prod<span class="fl">.2017</span><span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Illinois"     "Indiana"      "Iowa"         "Kansas"       "Minnesota"   
 [6] "Missouri"     "Nebraska"     "North Dakota" "Ohio"         "South Dakota"
[11] "Wisconsin"   </code></pre>
</div>
</div>
<p>Following command will select counties starting with “A”. filter() with <strong>grepl()</strong> is used to search for pattern matching.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>state.a <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^A"</span>, STATE_NAME))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(state.a <span class="sc">$</span>STATE_NAME))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Alabama"  "Arizona"  "Arkansas"</code></pre>
</div>
</div>
</section>
<section id="summarize" class="level4">
<h4 class="anchored" data-anchor-id="summarize">Summarize</h4>
<p><strong>Summarize</strong> is a function in the dplyr used to collapse multiple values in a data frame into a single summary value. The function takes a data frame as input and returns a smaller data frame with summary statistics, such as mean, sum, count, etc. It can be used with other dplyr functions to manipulate and analyze data.</p>
<blockquote class="blockquote">
<p>summarise(.data, …, .groups = NULL)</p>
</blockquote>
<ul>
<li><p><strong>Center</strong>: mean(), median()</p></li>
<li><p><strong>Spread</strong>: sd(), IQR(), mad()</p></li>
<li><p><strong>Range</strong>: min(), max(), quantile()</p></li>
<li><p><strong>Position</strong>: first(), last(), nth(),</p></li>
<li><p><strong>Count</strong>: n(), n_distinct()</p></li>
<li><p><strong>Logical</strong>: any(), all()</p></li>
</ul>
<p><strong>summarise()</strong> and <strong>summarize()</strong> are synonyms.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(df.corn, <span class="at">Mean=</span><span class="fu">mean</span>(MT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      Mean
     &lt;dbl&gt;
1 8360402.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># median</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(df.corn, <span class="at">Median=</span><span class="fu">median</span>(MT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
    Median
     &lt;dbl&gt;
1 2072749.</code></pre>
</div>
</div>
<p>The scoped variants (_if, _at, _all) of summarise() make it easy to apply the same transformation to multiple variables. There are three variants.</p>
<ul>
<li><p>summarise_at() affects variables selected with a character vector or vars()</p></li>
<li><p>summarise_all() affects every variable</p></li>
<li><p>summarise_if() affects variables selected with a predicate function</p></li>
</ul>
<p>Following <strong>summarise_at()</strong> function mean of SOC from USA soil data (soil).</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_at</span>(<span class="st">"SOC"</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
    SOC
  &lt;dbl&gt;
1  6.35</code></pre>
</div>
</div>
<p>For multiple variables:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_at</span>(<span class="fu">c</span>(<span class="st">"SOC"</span>, <span class="st">"NDVI"</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
    SOC  NDVI
  &lt;dbl&gt; &lt;dbl&gt;
1  6.35 0.437</code></pre>
</div>
</div>
<p>The <strong>summarise_if()</strong> variants apply a predicate function (a function that returns TRUE or FALSE) to determine the relevant subset of columns.</p>
<p>Here we apply mean() to the numeric columns:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_if</span>(is.numeric, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 15
     ID   FIPS STATE_ID Longi…¹ Latit…²   SOC   DEM Aspect Slope     TPI KFactor
  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1  238. 29151.     29.1   -104.    38.9  6.35 1632.   165.  4.84 0.00937   0.256
# … with 4 more variables: MAP &lt;dbl&gt;, MAT &lt;dbl&gt;, NDVI &lt;dbl&gt;, SiltClay &lt;dbl&gt;,
#   and abbreviated variable names ¹​Longitude, ²​Latitude</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 15
     ID   FIPS STATE_ID Longi…¹ Latit…²   SOC   DEM Aspect Slope     TPI KFactor
  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1  238. 29151.     29.1   -104.    38.9  6.35 1632.   165.  4.84 0.00937   0.256
# … with 4 more variables: MAP &lt;dbl&gt;, MAT &lt;dbl&gt;, NDVI &lt;dbl&gt;, SiltClay &lt;dbl&gt;,
#   and abbreviated variable names ¹​Longitude, ²​Latitude</code></pre>
</div>
</div>
<p>It is better to select first our target numerical columns and then apply <strong>summarise_all()</strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First select  numerical columns</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(SOC, DEM, NDVI, MAP, MAT) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get mean of all these variables</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_all</span>(mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 5
    SOC   DEM  NDVI   MAP   MAT
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  6.35 1632. 0.437  501.  8.88</code></pre>
</div>
</div>
</section>
<section id="mutate" class="level4">
<h4 class="anchored" data-anchor-id="mutate">Mutate</h4>
<p>*<strong>mutate()</strong> adds new columns to a data frame based on existing columns or variables. The new columns are specified by expressions that use the values from one or more existing columns. The function returns a new data frame with the added columns and the same number of rows as the original data frame.</p>
<blockquote class="blockquote">
<p>mutate(.data, …, .dots = NULL)</p>
</blockquote>
<p>In this exercise we will create a new column (MT_1000) in df.corn dataframe dividing MT column by 1000</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get mean of all these variables</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">MT_1000 =</span> MT <span class="sc">/</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 465
Columns: 7
$ DIVISION_ID   &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 4, 4, 4, 4, 4, 4,…
$ DIVISION_NAME &lt;chr&gt; "East South Central", "East South Central", "East South …
$ STATE_FIPS    &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 4, 4, 4, 4, 4, 4, 4, 4,…
$ STATE_NAME    &lt;chr&gt; "Alabama", "Alabama", "Alabama", "Alabama", "Alabama", "…
$ YEAR          &lt;dbl&gt; 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 20…
$ MT            &lt;dbl&gt; 734352.8, 1101529.2, 1151061.8, 914829.3, 960170.7, 9968…
$ MT_1000       &lt;dbl&gt; 73.43528, 110.15292, 115.10618, 91.48293, 96.01707, 99.6…</code></pre>
</div>
</div>
</section>
<section id="group-by" class="level4">
<h4 class="anchored" data-anchor-id="group-by">Group by</h4>
<p><strong>group_by()</strong> allows you to group a data frame by one or multiple variables. After grouping, you can perform operations on the grouped data, such as aggregating with <strong>summarize()</strong>, transforming with <strong>mutate()</strong>, or filtering with <strong>filter()</strong>. The result of grouping is a grouped tibble, which is a data structure that retains the grouping structure and allows you to perform further operations on the grouped data.</p>
<blockquote class="blockquote">
<p>group_by(.data, …, )</p>
</blockquote>
<p>We can calculate global mean of USA corn production by division:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(DIVISION_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Prod_MT =</span> <span class="fu">mean</span>(MT)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 2
  DIVISION_NAME        Prod_MT
  &lt;chr&gt;                  &lt;dbl&gt;
1 East North Central 22246702.
2 East South Central  3143670.
3 Middle Atlantic     2036263.
4 Mountain             712629.
5 New England           15203.
6 Pacific              384083.
7 South Atlantic      1163065.
8 West North Central 27893388.
9 West South Central  3163740.</code></pre>
</div>
</div>
<p>We can also apply the <strong>group_by()</strong>, <strong>summarize()</strong> and <strong>mutate()</strong> functions with pipe to calculate mean of corn production in 1000 MT by division for the year 2022</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(YEAR<span class="sc">==</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(DIVISION_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Prod_MT =</span> <span class="fu">mean</span>(MT)) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Prod_1000_MT =</span> Prod_MT <span class="sc">/</span> <span class="dv">1000</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  DIVISION_NAME        Prod_MT Prod_1000_MT
  &lt;chr&gt;                  &lt;dbl&gt;        &lt;dbl&gt;
1 East North Central 22746952.       22747.
2 East South Central  3350119.        3350.
3 Middle Atlantic     1929554.        1930.
4 Mountain             651221.         651.
5 Pacific              391731.         392.
6 South Atlantic      1223075.        1223.
7 West North Central 28281091.       28281.
8 West South Central  3009964.        3010.</code></pre>
</div>
</div>
<p>We can also apply the group_by() and summarize() functions to calculate statistic of multiple variable:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATE) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">SOC =</span> <span class="fu">mean</span>(SOC),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">NDVI =</span> <span class="fu">mean</span>(NDVI),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAP =</span> <span class="fu">mean</span>(MAP),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAT =</span> <span class="fu">mean</span>(MAT))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  STATE        SOC  NDVI   MAP   MAT
  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 Colorado    7.29 0.482  473.  6.93
2 Kansas      7.43 0.570  742. 12.6 
3 New Mexico  3.51 0.301  388. 11.6 
4 Wyoming     6.90 0.390  419.  5.27</code></pre>
</div>
</div>
<p>Following code will idenfify State where corn production data has not reported for the all years.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(STATE_NAME) <span class="sc">%&gt;%</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n <span class="sc">&lt;</span> <span class="dv">11</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  STATE_NAME        n
  &lt;chr&gt;         &lt;int&gt;
1 Connecticut       2
2 Maine             2
3 Massachusetts     2
4 Nevada            2
5 New Hampshire     2
6 Rhode Island      2
7 Vermont           2</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the state names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pivoting-data-frame" class="level4">
<h4 class="anchored" data-anchor-id="pivoting-data-frame">Pivoting Data-frame</h4>
<p>Pivoting a data frame in R involves transforming columns into rows and vice versa. In R, there are multiple ways to pivot a data frame, but the most common methods are:</p>
<p><strong>tidyr::pivot_wider</strong>: The pivot_wider() function is used to reshape a data frame from a long format to a wide format, in which each row becomes a variable, and each column is an observation.</p>
<p><strong>tidyr::pivot_longer</strong>: This is a relatively new function in the tidyr library that makes it easy to pivot a data frame from wide to long format. It is used to reshape a data frame from a wide format to a long format, in which each column becomes a variable, and each row is an observation.</p>
<p><strong>tidyr::spread()</strong>: This function is also used to pivot data from long to wide format. It creates new columns from the values of one column, based on the values of another column.</p>
<p><strong>tidy::gather()</strong> : This function is used to pivot data from wide to long format. It collects values of multiple columns into a single column, based on the values of another column.</p>
<section id="pivot_wider" class="level5">
<h5 class="anchored" data-anchor-id="pivot_wider">pivot_wider</h5>
<p>pivot_wider() convert a dataset wider by increasing the number of columns and decreasing the number of rows.</p>
<div class="cell" title="pivot_wider">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>corn.wider <span class="ot">=</span> df.corn  <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span> (STATE_FIPS,STATE_NAME, YEAR, MT) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Drop state where reporting years less than 11 </span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">filter</span>(STATE_NAME<span class="sc">!=</span> <span class="st">'Connecticut'</span>, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Maine'</span>,                        </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Massachusetts'</span>, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Nevada'</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'New Hampshire'</span>, </span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Rhode Island'</span>, </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Vermont'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>           tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> YEAR, <span class="at">values_from =</span> MT) <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 41
Columns: 13
$ STATE_FIPS &lt;dbl&gt; 1, 4, 5, 6, 8, 10, 12, 13, 16, 17, 18, 19, 20, 21, 22, 24, …
$ STATE_NAME &lt;chr&gt; "Alabama", "Arizona", "Arkansas", "California", "Colorado",…
$ `2012`     &lt;dbl&gt; 734352.8, 158504.4, 3142399.9, 823003.5, 3412162.2, 610394.…
$ `2013`     &lt;dbl&gt; 1101529.2, 229297.9, 4110445.0, 873298.1, 3261024.2, 733692…
$ `2014`     &lt;dbl&gt; 1151061.8, 149359.9, 2517526.9, 398166.0, 3745681.8, 853485…
$ `2015`     &lt;dbl&gt; 914829.3, 192034.1, 2045951.0, 239280.6, 3426640.9, 799837.…
$ `2016`     &lt;dbl&gt; 960170.7, 273064.4, 3236003.9, 469924.8, 4071581.0, 708189.…
$ `2017`     &lt;dbl&gt; 996875.6, 158504.4, 2765825.0, 339361.9, 4722109.3, 820946.…
$ `2018`     &lt;dbl&gt; 970839.3, 111765.9, 2965479.6, 285638.1, 3929587.5, 611410.…
$ `2019`     &lt;dbl&gt; 1138869.1, 217105.3, 3267247.5, 256045.5, 4061674.5, 736130…
$ `2020`     &lt;dbl&gt; 1284291.8, 148801.1, 2827677.3, 285003.1, 3123348.9, 715301…
$ `2021`     &lt;dbl&gt; 1407742.3, 82757.6, 3879292.8, 238772.6, 3768289.0, 803901.…
$ `2022`     &lt;dbl&gt; 869233.9, 223531.8, 3054130.3, 89920.8, 3012091.0, 721144.1…</code></pre>
</div>
</div>
</section>
<section id="pivot_longer" class="level5">
<h5 class="anchored" data-anchor-id="pivot_longer">pivot_longer</h5>
<p>The pivot_longer() function can be used to pivot a data frame from a wide format to a long format.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(corn.wider)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "STATE_FIPS" "STATE_NAME" "2012"       "2013"       "2014"      
 [6] "2015"       "2016"       "2017"       "2018"       "2019"      
[11] "2020"       "2021"       "2022"      </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>corn.longer<span class="ot">&lt;-</span> corn.wider <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>               tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="fu">c</span>(<span class="st">"2012"</span>, <span class="st">"2013"</span>, <span class="st">"2014"</span>, <span class="st">"2015"</span>, <span class="st">"2016"</span>, <span class="st">"2017"</span>,                                              <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>,  <span class="st">"2022"</span>),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">names_to =</span> <span class="st">"YEAR"</span>, <span class="co"># column need to be wider</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_to =</span> <span class="st">"MT"</span>) <span class="co"># data</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(corn.longer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  STATE_FIPS STATE_NAME YEAR        MT
       &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;dbl&gt;
1          1 Alabama    2012   734353.
2          1 Alabama    2013  1101529.
3          1 Alabama    2014  1151062.
4          1 Alabama    2015   914829.
5          1 Alabama    2016   960171.
6          1 Alabama    2017   996876.</code></pre>
</div>
</div>
<p>Following command combined select(), rename(), summarize() and pivot_longer() the data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First select  numerical columns</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(SOC, DEM, NDVI, MAP, MAT) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get summary statistics</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise_all</span>(<span class="fu">funs</span>(<span class="at">min =</span> min, </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">q25 =</span> <span class="fu">quantile</span>(., <span class="fl">0.25</span>), </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">median =</span> median, </span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">q75 =</span> <span class="fu">quantile</span>(., <span class="fl">0.75</span>), </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max =</span> max,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mean =</span> mean, </span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sd =</span> sd)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a nice looking table</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_sep =</span> <span class="st">"_"</span>, <span class="at">names_to =</span> <span class="fu">c</span>( <span class="st">"variable"</span>, <span class="st">".value"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 8
  variable     min      q25   median      q75      max     mean      sd
  &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
1 SOC        0.408    2.77     4.97     8.71    30.5      6.35    5.05 
2 DEM      259.    1175.    1593.    2238.    3618.    1632.    770.   
3 NDVI       0.142    0.308    0.417    0.557    0.797    0.437   0.162
4 MAP      194.     354.     434.     591.    1128.     501.    207.   
5 MAT       -0.591    5.87     9.17    12.4     16.9      8.88    4.10 </code></pre>
</div>
</div>
</section>
<section id="spread" class="level5">
<h5 class="anchored" data-anchor-id="spread">Spread</h5>
<p><strong>dplyr::spread()</strong> is equivalent to <strong>tidyr::pivot_wider()</strong>:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span> (STATE_FIPS, YEAR, STATE_NAME, MT) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">spread</span>(YEAR, MT) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 13
   STATE…¹ STATE…² `2012`  `2013`  `2014`  `2015`  `2016` `2017`  `2018`  `2019`
     &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1       1 Alabama 7.34e5  1.10e6  1.15e6  9.15e5  9.60e5 9.97e5  9.71e5  1.14e6
 2       4 Arizona 1.59e5  2.29e5  1.49e5  1.92e5  2.73e5 1.59e5  1.12e5  2.17e5
 3       5 Arkans… 3.14e6  4.11e6  2.52e6  2.05e6  3.24e6 2.77e6  2.97e6  3.27e6
 4       6 Califo… 8.23e5  8.73e5  3.98e5  2.39e5  4.70e5 3.39e5  2.86e5  2.56e5
 5       8 Colora… 3.41e6  3.26e6  3.75e6  3.43e6  4.07e6 4.72e6  3.93e6  4.06e6
 6       9 Connec… 2.05e4 NA      NA      NA      NA      2.32e4 NA      NA     
 7      10 Delawa… 6.10e5  7.34e5  8.53e5  8.00e5  7.08e5 8.21e5  6.11e5  7.36e5
 8      12 Florida 1.17e5  2.64e5  1.37e5  1.79e5  1.47e5 1.51e5  2.47e5  2.21e5
 9      13 Georgia 1.42e6  2.07e6  1.34e6  1.24e6  1.43e6 1.10e6  1.27e6  1.42e6
10      16 Idaho   6.69e5  5.29e5  4.06e5  3.68e5  4.78e5 5.93e5  6.76e5  7.81e5
# … with 38 more rows, 3 more variables: `2020` &lt;dbl&gt;, `2021` &lt;dbl&gt;,
#   `2022` &lt;dbl&gt;, and abbreviated variable names ¹​STATE_FIPS, ²​STATE_NAME</code></pre>
</div>
</div>
</section>
<section id="gather" class="level5">
<h5 class="anchored" data-anchor-id="gather">Gather</h5>
<p><strong>tidyr::gather(“key”, “value”, x, y, z)</strong> is equivalent to <strong>tidyr::pivot_longer()</strong></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>corr.gathered<span class="ot">&lt;-</span>corn.wider <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">gather</span>(<span class="at">key =</span> YEAR, <span class="at">value =</span> MT, <span class="sc">-</span>STATE_FIPS, <span class="sc">-</span>STATE_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 451
Columns: 4
$ STATE_FIPS &lt;dbl&gt; 1, 4, 5, 6, 8, 10, 12, 13, 16, 17, 18, 19, 20, 21, 22, 24, …
$ STATE_NAME &lt;chr&gt; "Alabama", "Arizona", "Arkansas", "California", "Colorado",…
$ YEAR       &lt;chr&gt; "2012", "2012", "2012", "2012", "2012", "2012", "2012", "20…
$ MT         &lt;dbl&gt; 734352.8, 158504.4, 3142399.9, 823003.5, 3412162.2, 610394.…</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="cleaning-a-messy-data" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-a-messy-data">Cleaning a messy data</h3>
<p>In this exercise you will learn how a clean data and make it ready for analysis, such as dealing with missing values, data with below detection limit and cleaning spatial characters. We will clean <strong>usa_geochemical_raw.csv</strong> data for further analysis. The data could be found <a href="https://www.dropbox.com/sh/n1bxn0rmrabtcjn/AADvgwWvMFpNfwSPu0gbb17ja?dl=0">here</a></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a data folder</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>dataFolder<span class="ot">&lt;-</span><span class="st">"E:/Dropbox/GitHub/Data/USA/"</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>df.geo<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder,<span class="st">"usa_geochemical_raw.csv"</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>meta.geo<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder,<span class="st">"usa_geochemical_meta_data.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df.geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,857
Columns: 56
$ A_LabID    &lt;chr&gt; "C-328943", "C-328929", "C-328930", "C-329034", "C-328968",…
$ SiteID     &lt;dbl&gt; 96, 208, 288, 656, 912, 1232, 1312, 1488, 1680, 1824, 2144,…
$ StateID    &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL",…
$ Latitude   &lt;dbl&gt; 31.3146, 33.8523, 31.2179, 33.0992, 34.5501, 34.3577, 31.06…
$ Longitude  &lt;dbl&gt; -87.1166, -86.9041, -85.8788, -86.9976, -87.6779, -87.3130,…
$ CollDate   &lt;chr&gt; "2/18/2009", "2/26/2009", "2/18/2009", "2/23/2009", "2/25/2…
$ LandCover1 &lt;chr&gt; "Planted/Cultivated", "Developed", "Planted/Cultivated", "F…
$ LandCover2 &lt;chr&gt; "Pasture/Hay", "Low Intensity Residential", "Fallow", "Ever…
$ A_Depth    &lt;chr&gt; "0-20", "0-20", "0-20", "0-20", "0-5", "0-10", "0-25", "0-3…
$ A_Ag       &lt;chr&gt; "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1", "&lt;1",…
$ A_Al       &lt;chr&gt; "0.87", "1.15", "1.05", "4.17", "1.51", "2.78", "2.14", "1.…
$ A_As       &lt;chr&gt; "1.6", "1.5", "1.2", "3.7", "2.7", "4.3", "2.7", "3.7", "2.…
$ A_Ba       &lt;chr&gt; "49", "118", "34", "316", "179", "160", "50", "185", "77", …
$ A_Be       &lt;chr&gt; "0.2", "0.4", "0.2", "1.1", "0.6", "0.5", "0.3", "0.5", "0.…
$ A_Bi       &lt;chr&gt; "0.08", "0.1", "0.07", "0.16", "0.09", "0.19", "0.16", "0.2…
$ A_C_Tot    &lt;chr&gt; "0.71", "0.88", "0.65", "1.14", "1.36", "1.71", "0.89", "4.…
$ A_C_Inorg  &lt;chr&gt; "N.D.", "N.D.", "N.D.", "N.D.", "N.D.", "N.D.", "N.D.", "N.…
$ A_C_Org    &lt;chr&gt; "0.71", "0.88", "0.65", "1.14", "1.36", "1.71", "0.89", "4.…
$ A_Ca       &lt;chr&gt; "0.07", "0.02", "0.05", "0.05", "0.03", "0.02", "0.04", "0.…
$ A_Cd       &lt;chr&gt; "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "0.…
$ A_Ce       &lt;chr&gt; "25.2", "27.8", "42.2", "41.7", "61.7", "32.6", "48.6", "44…
$ A_Co       &lt;chr&gt; "1.2", "2.4", "1", "7", "6.1", "3.5", "1.5", "3.9", "1.3", …
$ A_Cr       &lt;chr&gt; "11", "14", "8", "28", "17", "30", "17", "22", "22", "10", …
$ A_Cs       &lt;chr&gt; "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5", "&lt;5",…
$ A_Cu       &lt;chr&gt; "4.4", "6.1", "10.9", "13.8", "5.2", "8.4", "15.1", "10.1",…
$ A_Fe       &lt;chr&gt; "0.57", "0.54", "0.38", "2.38", "1.06", "1.66", "0.9", "1.1…
$ A_Ga       &lt;chr&gt; "1.96", "2.24", "1.98", "9.53", "3.29", "6.43", "4.22", "4.…
$ A_Hg       &lt;chr&gt; "0.01", "0.02", "&lt;0.01", "0.03", "0.03", "0.05", "0.02", "0…
$ A_In       &lt;chr&gt; "&lt;0.02", "&lt;0.02", "&lt;0.02", "0.03", "&lt;0.02", "0.02", "&lt;0.02"…
$ A_K        &lt;chr&gt; "0.09", "0.25", "0.05", "0.89", "0.44", "0.46", "0.1", "0.3…
$ A_La       &lt;chr&gt; "11.4", "13.8", "23.4", "20.6", "21", "16.3", "22.3", "20.9…
$ A_Li       &lt;chr&gt; "5", "8", "5", "21", "6", "17", "9", "18", "8", "4", "7", "…
$ A_Mg       &lt;chr&gt; "0.03", "0.05", "0.03", "0.16", "0.06", "0.11", "0.04", "0.…
$ A_Mn       &lt;chr&gt; "81", "191", "249", "228", "321", "96", "155", "598", "76",…
$ A_Mo       &lt;chr&gt; "0.34", "0.36", "0.41", "1.19", "0.48", "0.66", "0.76", "0.…
$ A_Na       &lt;chr&gt; "&lt;0.01", "0.02", "&lt;0.01", "0.06", "0.06", "0.05", "&lt;0.01", …
$ A_Nb       &lt;chr&gt; "5.2", "3.5", "3.4", "8.4", "0.6", "9.1", "7.1", "6.1", "2.…
$ A_Ni       &lt;chr&gt; "3.2", "4.6", "4.2", "11.5", "6.9", "8.4", "7.7", "7", "3.8…
$ A_P        &lt;chr&gt; "260", "170", "510", "200", "200", "190", "680", "440", "10…
$ A_Pb       &lt;chr&gt; "6.8", "11.6", "7", "14", "14.5", "15.4", "10.5", "26.6", "…
$ A_Rb       &lt;chr&gt; "8.4", "20", "5.7", "57.8", "24.6", "31.8", "9", "24.7", "1…
$ A_S        &lt;chr&gt; "&lt;0.01", "&lt;0.01", "&lt;0.01", "0.01", "0.01", "0.01", "&lt;0.01",…
$ A_Sb       &lt;chr&gt; "0.19", "0.23", "0.19", "0.62", "0.1", "0.46", "0.3", "0.4"…
$ A_Sc       &lt;chr&gt; "1.6", "1.6", "1.4", "7.5", "2.2", "4.1", "3.1", "2.5", "3.…
$ A_Se       &lt;chr&gt; "&lt;0.2", "&lt;0.2", "&lt;0.2", "0.5", "&lt;0.2", "0.4", "0.2", "0.4",…
$ A_Sn       &lt;chr&gt; "0.5", "0.5", "0.6", "1.3", "0.4", "1", "1.1", "1.3", "1", …
$ A_Sr       &lt;chr&gt; "6.2", "15.2", "3.9", "30.4", "21.9", "27.2", "6.7", "27.9"…
$ A_Te       &lt;chr&gt; "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0…
$ A_Th       &lt;chr&gt; "4.4", "3.2", "3", "8.2", "5", "7.1", "7.2", "5.9", "9.2", …
$ A_Ti       &lt;chr&gt; "0.24", "0.13", "0.13", "0.31", "0.05", "0.28", "0.3", "0.1…
$ A_Tl       &lt;chr&gt; "&lt;0.1", "0.2", "&lt;0.1", "0.5", "0.3", "0.4", "0.1", "0.3", "…
$ A_U        &lt;chr&gt; "1.4", "1.1", "1", "2.4", "1.4", "2.2", "2", "1.9", "1.9", …
$ A_V        &lt;chr&gt; "14", "16", "12", "56", "21", "37", "27", "30", "26", "22",…
$ A_W        &lt;chr&gt; "0.3", "0.3", "0.4", "0.8", "&lt;0.1", "0.7", "0.6", "0.4", "&lt;…
$ A_Y        &lt;chr&gt; "3.8", "4.9", "16.3", "8.8", "8.4", "6.7", "9.1", "9.4", "5…
$ A_Zn       &lt;chr&gt; "15", "17", "19", "32", "32", "28", "26", "48", "20", "34",…</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(meta.geo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 54
Columns: 3
$ FIELS_ID    &lt;chr&gt; "Lab_ID", "SiteID", "StateID", "CollDate", "LandCover1", "…
$ Description &lt;chr&gt; "unique identifier assigned by the analytical laboratories…
$ Unit        &lt;chr&gt; NA, NA, NA, NA, NA, NA, "cm", "mg/kg", "wt. %", "mg/kg", "…</code></pre>
</div>
</div>
<p>We first create a file with limited number of variables using <strong>select</strong> functions and rename them:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mf.geo <span class="ot">&lt;-</span> df.geo <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(A_LabID, StateID,  LandCover1, A_Depth, A_C_Tot, A_C_Inorg, A_C_Org, A_As, A_Cd,  A_Pb, A_Cr) <span class="sc">%&gt;%</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="st">"LAB_ID"</span><span class="ot">=</span>A_LabID,</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">"LandCover"</span> <span class="ot">=</span>LandCover1,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Soil_depth"</span> <span class="ot">=</span> A_Depth,</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Total_Carbon"</span> <span class="ot">=</span> A_C_Tot,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Inorg_Carbon"</span> <span class="ot">=</span> A_C_Inorg,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Organic_Carbon"</span><span class="ot">=</span> A_C_Org, </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Arsenic"</span> <span class="ot">=</span> A_As,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cadmium"</span> <span class="ot">=</span> A_Cd,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Lead"</span> <span class="ot">=</span> A_Pb,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Chromium"</span> <span class="ot">=</span> A_Cr) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,857
Columns: 11
$ LAB_ID         &lt;chr&gt; "C-328943", "C-328929", "C-328930", "C-329034", "C-3289…
$ StateID        &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "…
$ LandCover      &lt;chr&gt; "Planted/Cultivated", "Developed", "Planted/Cultivated"…
$ Soil_depth     &lt;chr&gt; "0-20", "0-20", "0-20", "0-20", "0-5", "0-10", "0-25", …
$ Total_Carbon   &lt;chr&gt; "0.71", "0.88", "0.65", "1.14", "1.36", "1.71", "0.89",…
$ Inorg_Carbon   &lt;chr&gt; "N.D.", "N.D.", "N.D.", "N.D.", "N.D.", "N.D.", "N.D.",…
$ Organic_Carbon &lt;chr&gt; "0.71", "0.88", "0.65", "1.14", "1.36", "1.71", "0.89",…
$ Arsenic        &lt;chr&gt; "1.6", "1.5", "1.2", "3.7", "2.7", "4.3", "2.7", "3.7",…
$ Cadmium        &lt;chr&gt; "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1", "&lt;0.1",…
$ Lead           &lt;chr&gt; "6.8", "11.6", "7", "14", "14.5", "15.4", "10.5", "26.6…
$ Chromium       &lt;chr&gt; "11", "14", "8", "28", "17", "30", "17", "22", "22", "1…</code></pre>
</div>
</div>
<p>Now, we filter the data where records have N.S. values INS:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mf.geo<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Soil_depth <span class="sc">!=</span> <span class="st">"N.S."</span> <span class="sc">&amp;</span> Total_Carbon <span class="sc">!=</span><span class="st">"INS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, we will convert all N.D. values to empty string:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mf.geo[mf.geo<span class="sc">==</span><span class="st">"N.D."</span>]<span class="ot">&lt;-</span> <span class="st">""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here detection limits of As, Cd, Pb and Cr are 0.6, 0.1, 0.5, and 1 mg/kg, respectively. We will replace the values below detection limits by half of detection limits of these heavy-metals. Before that we have to remove <strong>“&lt;”</strong> and convert the all <chr> to <double>.</double></chr></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>mf.geo <span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Arsenic"</span>, <span class="st">"Cadmium"</span>, <span class="st">"Lead"</span>, <span class="st">"Chromium"</span>), str_replace, <span class="st">"&lt;"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">11</span>), as.numeric) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 2 warnings in `mutate()`.
The first warning was:
ℹ In argument: `Inorg_Carbon = .Primitive("as.double")(Inorg_Carbon)`.
Caused by warning:
! NAs introduced by coercion
ℹ Run `dplyr::last_dplyr_warnings()` to see the 1 remaining warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,809
Columns: 11
$ LAB_ID         &lt;chr&gt; "C-328943", "C-328929", "C-328930", "C-329034", "C-3289…
$ StateID        &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "…
$ LandCover      &lt;chr&gt; "Planted/Cultivated", "Developed", "Planted/Cultivated"…
$ Soil_depth     &lt;chr&gt; "0-20", "0-20", "0-20", "0-20", "0-5", "0-10", "0-25", …
$ Total_Carbon   &lt;dbl&gt; 0.71, 0.88, 0.65, 1.14, 1.36, 1.71, 0.89, 4.59, 2.32, 0…
$ Inorg_Carbon   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ Organic_Carbon &lt;dbl&gt; 0.71, 0.88, 0.65, 1.14, 1.36, 1.71, 0.89, 4.59, 2.32, 0…
$ Arsenic        &lt;dbl&gt; 1.6, 1.5, 1.2, 3.7, 2.7, 4.3, 2.7, 3.7, 2.9, 3.0, 2.3, …
$ Cadmium        &lt;dbl&gt; 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, …
$ Lead           &lt;dbl&gt; 6.8, 11.6, 7.0, 14.0, 14.5, 15.4, 10.5, 26.6, 13.2, 12.…
$ Chromium       &lt;dbl&gt; 11, 14, 8, 28, 17, 30, 17, 22, 22, 10, 17, 10, 31, 11, …</code></pre>
</div>
</div>
<p>Now replace values below detection limits:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Arsenic"</span>][mf.geo[<span class="st">"Arsenic"</span>] <span class="sc">==</span> <span class="fl">0.6</span>] <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Cadmium"</span>][mf.geo[<span class="st">"Cadmium"</span>] <span class="sc">==</span> <span class="fl">0.1</span>] <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Lead"</span>][mf.geo[<span class="st">"Lead"</span>] <span class="sc">==</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Chromium"</span>][mf.geo[<span class="st">"Chromium"</span>] <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now will check the missing values of the data:</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># counting unique, missing, and median values</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>Arsenic<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Arsenic),</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Arsenic)),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Arsenic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Arsenic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>Cadmium<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Cadmium),</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Cadmium)),</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Cadmium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Cadmium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>Lead<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Lead),</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Lead)),</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Lead, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Lead, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>Chromium<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Chromium),</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Chromium)),</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Chromium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Chromium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a><span class="co">#bind the data</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>geo.sum<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Arsenic, Cadmium, Lead, Chromium)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="co">#add.row.names</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(geo.sum) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Arsenic"</span>, <span class="st">"Cadmium"</span>, <span class="st">"Lead"</span>, <span class="st">"Chromium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Setting row names on a tibble is deprecated.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(geo.sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
      N    na   Min    Max
  &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  4809     0  0.3  1110  
2  4809     0  0.05   46.6
3  4809     0  0.25 2200  
4  4809     0  0.5  3850  </code></pre>
</div>
</div>
<p>One of the common method of replacing missing values is <strong>na.omit</strong>. The function <strong>na.omit()</strong> returns the object with listwise deletion of missing values and function create new dataset without missing data.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(mf.geo)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(newdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,167
Columns: 11
$ LAB_ID         &lt;chr&gt; "C-329044", "C-329030", "C-329081", "C-329079", "C-3289…
$ StateID        &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AR", "AR", "AZ", "AZ", "…
$ LandCover      &lt;chr&gt; "Planted/Cultivated", "Developed", "Planted/Cultivated"…
$ Soil_depth     &lt;chr&gt; "0-20", "0-20", "0-15", "0-7", "0-20", "0-10", "0-5", "…
$ Total_Carbon   &lt;dbl&gt; 2.90, 4.78, 0.75, 1.69, 1.00, 1.00, 1.88, 0.31, 2.13, 0…
$ Inorg_Carbon   &lt;dbl&gt; 1.8, 3.7, 0.1, 0.1, 0.2, 0.1, 0.1, 0.2, 0.9, 0.4, 0.1, …
$ Organic_Carbon &lt;dbl&gt; 1.1, 1.1, 0.7, 1.6, 0.8, 0.9, 1.8, 0.1, 1.2, 0.3, 0.8, …
$ Arsenic        &lt;dbl&gt; 5.9, 7.9, 5.6, 7.2, 2.9, 4.8, 1.9, 5.3, 4.5, 5.0, 4.0, …
$ Cadmium        &lt;dbl&gt; 0.20, 0.20, 0.05, 0.20, 0.05, 0.05, 0.05, 0.20, 0.20, 0…
$ Lead           &lt;dbl&gt; 20.9, 19.1, 12.9, 21.1, 14.1, 11.9, 8.7, 26.8, 14.7, 24…
$ Chromium       &lt;dbl&gt; 73, 68, 37, 42, 36, 31, 16, 36, 35, 28, 30, 25, 62, 21,…</code></pre>
</div>
</div>
<p>This function delete all records with missing values. Now newdata have only 1,167 records, since Inorg_Carbon variable has 3,690 missing values which all are omitted.</p>
<p>We can impute missing values in several ways. The easiest way to impute missing values is by replacing the mean values of the variable. The following code replace missing of Arsenic, Cadmium, Lead and Chromium with their mean values.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>mf.geo.new<span class="ot">&lt;-</span>mf.geo <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Arsenic, Cadmium, Lead, Chromium),<span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x), <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .x)) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,809
Columns: 11
$ LAB_ID         &lt;chr&gt; "C-328943", "C-328929", "C-328930", "C-329034", "C-3289…
$ StateID        &lt;chr&gt; "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "AL", "…
$ LandCover      &lt;chr&gt; "Planted/Cultivated", "Developed", "Planted/Cultivated"…
$ Soil_depth     &lt;chr&gt; "0-20", "0-20", "0-20", "0-20", "0-5", "0-10", "0-25", …
$ Total_Carbon   &lt;dbl&gt; 0.71, 0.88, 0.65, 1.14, 1.36, 1.71, 0.89, 4.59, 2.32, 0…
$ Inorg_Carbon   &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ Organic_Carbon &lt;dbl&gt; 0.71, 0.88, 0.65, 1.14, 1.36, 1.71, 0.89, 4.59, 2.32, 0…
$ Arsenic        &lt;dbl&gt; 1.6, 1.5, 1.2, 3.7, 2.7, 4.3, 2.7, 3.7, 2.9, 3.0, 2.3, …
$ Cadmium        &lt;dbl&gt; 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.20, 0.05, 0…
$ Lead           &lt;dbl&gt; 6.8, 11.6, 7.0, 14.0, 14.5, 15.4, 10.5, 26.6, 13.2, 12.…
$ Chromium       &lt;dbl&gt; 11, 14, 8, 28, 17, 30, 17, 22, 22, 10, 17, 10, 31, 11, …</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>mf.geo.new <span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(Chromium)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  `sum(is.na(Chromium))`
                   &lt;int&gt;
1                      0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save clean data</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co">#write_csv(mf.geo.new,"usa_geochemical_clean.csv" )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<ol type="1">
<li><p>Create a folder in your computer name Homework.</p></li>
<li><p>Create a R-Markdown Project on this Homework directory</p></li>
<li><p>Create a R-Markdown documents (name homework_01.rmd) in this project directory and do all Tasks (1 to 23) using the data shown below.</p></li>
<li><p>Submit all codes and output as a HTML document (homework_02.html) before class of next week.</p></li>
</ol>
<section id="required-r-package" class="level4">
<h4 class="anchored" data-anchor-id="required-r-package">Required R-Package</h4>
<blockquote class="blockquote">
<p>library(tidyverse)</p>
</blockquote>
</section>
<section id="data-1" class="level4">
<h4 class="anchored" data-anchor-id="data-1">Data</h4>
<ol type="1">
<li><p><a href="https://www.dropbox.com/s/civw156b81mhvm6/bd_rice_production.csv?dl=0">bd_rice_production.csv</a>: Yearly rice production of Bangladesh</p></li>
<li><p><a href="https://www.dropbox.com/s/jnaq80qq8rnxhp9/bd_district.csv?dl=0">bd_district.csv</a>: District names with DISTRICT_ID and DIVISION_PCODE</p></li>
<li><p><a href="https://www.dropbox.com/s/iofedcoopx5tkwa/bd_division.csv?dl=0">bd_division.csv</a> Division names and DIVISION_PCODE</p></li>
<li><p><a href="https://www.dropbox.com/s/pdaclpszt9bto8b/raj_soil_data.csv?dl=0">raj_soil_data.csv</a>: SRDI soil data for Rajshahi Division</p></li>
<li><p><a href="https://www.dropbox.com/s/cc41v0an9ia5w52/bd_soil_data_raw.csv?dl=0">bd_soil_data_raw.csv</a>: SRDI soil data, not cleaned</p></li>
</ol>
<p>Download all above data and save in your project directory. Use read_csv to load the data in your R-session. For example:</p>
<blockquote class="blockquote">
<p>rice&lt;-read_csv(“bd_rice_production.csv”))</p>
</blockquote>
</section>
<section id="tasks" class="level4">
<h4 class="anchored" data-anchor-id="tasks">Tasks</h4>
<ol type="1">
<li><p>Join rice production, and district file using dplyr::inner_join()</p></li>
<li><p>Then join division file using dplyr::inner_join()</p></li>
<li><p>Organize column as (DIVISION_ID, DIVISION_NAME, DISTRICT_ID, DISTRICT_NAME, YEAR, MT using dplyr::relocate()</p></li>
<li><p>Rename “DISTRICT_ID” to “DISTRICT_PCODE” using dplyr::rename()</p></li>
<li><p>Run all the above code using pipe function in a single line and create a data frame name df.rice.csv</p></li>
<li><p>Form df.rice data that you have created before, use select() function to create a data frame only with DISTRICT_NAME, YEAR and MT</p></li>
<li><p>Filter out the data from Rajshahi division using dplyr::filter()</p></li>
<li><p>Filter (Filtering by multiple criteria) all district in Rajshahi and Dhaka divisions using dplyr::filter()</p></li>
<li><p>Use <strong>|</strong> or <strong>OR</strong> in the logical condition in filter function, select data from any of the two divisions.</p></li>
<li><p>Apply filter create a files for the Rajshai Division only with Bogra District.</p></li>
<li><p>Select districts where rice production (MT) is greater than the global average</p></li>
<li><p>Use <strong>&amp;</strong> to select district where <code>MT</code> is greater than the global average of for the year 2018-2019</p></li>
<li><p>Select districts starting with “P”</p></li>
<li><p>Use raj_soil data to calculate mean of SOM using dplyr::summarise_at() function</p></li>
<li><p>Use bd_soil data to calculate mean of SOM and NDVI using dplyr::summarise_at() function</p></li>
<li><p>Use dplyr::summarise_if() to calculate mean() to the numeric columns</p></li>
<li><p>Select numerical columns (pH,SOM, DEM, NDVI, NDFI) and then apply dplyr::summarise_all()*to calculate mean of these variables</p></li>
<li><p>Create a new column (MT_1000) in df.rice dataframe dividing MT column by 1000 using mutate()</p></li>
<li><p>Apply the group_by(), summarize()** and mutate() functions with pipe to calculate mean of corn production in 1000 MT by division for the year 2018-2019</p></li>
<li><p>Use df.rice data to create a wider data frame using tidyr::pivot_wider() function</p></li>
<li><p>Convert rice.wider data to a longer format use tidyr::pivot_longer()</p></li>
<li><p>Clean bd_soil_data_raw.csv and save as bd_soil_data.final.csv. Follow the steps you have learned from “Cleaning a messy data” section.</p></li>
</ol>
</section>
</section>
<section id="further-reading" class="level3">
<h3 class="anchored" data-anchor-id="further-reading">Further Reading</h3>
<ol type="1">
<li><p><a href="https://r4ds.had.co.nz/">R for Data Science</a></p></li>
<li><p><a href="https://cengel.github.io/R-data-wrangling/">Data Wrangling with R</a></p></li>
<li><p><a href="https://link.springer.com/book/10.1007/978-3-319-45599-0">Book: Data Wrangling with R</a></p></li>
<li><p><a href="https://github.com/rstudio/webinars/blob/master/05-Data-Wrangling-with-R-and-RStudio/wrangling-webinar.pdf">PDF Data wrangling with R and RStudio</a></p></li>
<li><p><a href="https://www.youtube.com/watch?v=CnY5Y5ANnjE">Youtube Data Wrangling with R and the Tidyverse - Workshop</a></p></li>
</ol>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb92" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Wrangling with dplyr and tidyr {.unnumbered}</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>In section you will learn you to wrangle data with two popular R-packages **tidyr** and **dplyr** and both are come with <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span>, an collection of several R packages designed for data science.</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">### **tidyr - Package**</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="al">![](Image/tidyR.png)</span>{width="174"}</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">tidyr</span><span class="co">](https://tidyr.tidyverse.org/)</span> helps to create tidy data that enables you to work with <span class="co">[</span><span class="ot">tidy data</span><span class="co">](https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html)</span> formats which are easy to manipulate, model and visualize, and have a specific structure. It follows a set of rules for organizing variables, values, and observations into tables, with each column representing a variable and each row representing an observation. Tidy data makes it easier to perform data analysis and visualization and is the preferred format for many data analysis tools and techniques.</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>**tidyr** functions fall into five main categories:</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Pivotting** which converts between long(**pivot_longer()**) and wide forms (**pivot_wider()**), replacing</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Rectangling**, which turns deeply nested lists (as from JSON) into tidy tibbles.</span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Nesting** converts grouped data to a form where each group becomes a single row containing a nested data frame</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Splitting and combining character columns**. Use **separate()** and **extract()** to pull a single character column into multiple columns;</span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Make implicit missing values explicit with **complete()**; make explicit missing values implicit with **drop_na()**; replace missing values with next/previous value with **fill()**, or a known value with **replace_na()**.</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a><span class="fu">### **dplyr - Package**</span></span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a><span class="al">![](Image/dplyR.png)</span>{width="192"}</span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">dplyr</span><span class="co">](https://dplyr.tidyverse.org/)</span> is part of a larger <span class="sc">\[</span>tidyverse<span class="sc">\]</span>( https://www.tidyverse.org/. It provides a grammar for data manipulation and a set of functions to clean, process, and aggregate data efficiently. Some of the key features of dplyr include:</span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a>A **tibble** data structure, which is similar to a data frame but is designed to be more efficient and easier to work with. A set of verbs for data manipulation, including **filter()** for subsetting rows, **arrange()** for sorting rows, **select()** for selecting columns, **mutate()** for adding new columns, and **summarize()** for aggregating data. A chainable syntax with **pipe (%\&gt;%)** that makes it easy to perform multiple operations in a single line of code.Support for working with remote data sources, including databases and big data systems. Overall, dplyr is a popular and widely used package for data manipulation in R and is known for its simplicity and ease of use.</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a>In addition to data frames/tibbles, dplyr makes working with following packages:</span>
<span id="cb92-32"><a href="#cb92-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-33"><a href="#cb92-33" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**dtplyr**</span><span class="co">](https://dtplyr.tidyverse.org/)</span>: for large, in-memory datasets. Translates your dplyr code to high performance data.table code.</span>
<span id="cb92-34"><a href="#cb92-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-35"><a href="#cb92-35" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**dbplyr**</span><span class="co">](https://dbplyr.tidyverse.org/)</span>: for data stored in a relational database. Translates your dplyr code to SQL.</span>
<span id="cb92-36"><a href="#cb92-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-37"><a href="#cb92-37" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">**sparklyr**</span><span class="co">](https://spark.rstudio.com/)</span>: for very large datasets stored in Apache Spark.</span>
<span id="cb92-38"><a href="#cb92-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-39"><a href="#cb92-39" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cheat-sheet</span></span>
<span id="cb92-40"><a href="#cb92-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-41"><a href="#cb92-41" aria-hidden="true" tabindex="-1"></a>Here below data Wrangling with <span class="co">[</span><span class="ot">dplyr and tidyr Cheat Sheets</span><span class="co">](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)</span>:</span>
<span id="cb92-42"><a href="#cb92-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-43"><a href="#cb92-43" aria-hidden="true" tabindex="-1"></a><span class="al">![Data Wragling with dplyrand tidyr Cheat sheet-2](Image/data_wragling%20cheat_sheet_01.png)</span>{#fig-dplyr_tidyr_01}</span>
<span id="cb92-44"><a href="#cb92-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-45"><a href="#cb92-45" aria-hidden="true" tabindex="-1"></a><span class="al">![Data Wragling with dplyrand tidyr Cheat sheet-1](Image/data_wragling%20cheat_sheet_02.png)</span>{fig-dplyr_tidyr_02}</span>
<span id="cb92-46"><a href="#cb92-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-47"><a href="#cb92-47" aria-hidden="true" tabindex="-1"></a>In addition to tidyr, and dplyr, there are five packages (including stringr and forcats) which are designed to work with specific types of data:</span>
<span id="cb92-48"><a href="#cb92-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-49"><a href="#cb92-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**lubridate** for dates and date-times.</span>
<span id="cb92-50"><a href="#cb92-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-51"><a href="#cb92-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**hms** for time-of-day values.</span>
<span id="cb92-52"><a href="#cb92-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-53"><a href="#cb92-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**blob** for storing blob (binary) data</span>
<span id="cb92-54"><a href="#cb92-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-55"><a href="#cb92-55" aria-hidden="true" tabindex="-1"></a><span class="fu">### Install tidyverse</span></span>
<span id="cb92-56"><a href="#cb92-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-57"><a href="#cb92-57" aria-hidden="true" tabindex="-1"></a>You can install the tidyverse with a following line of code:</span>
<span id="cb92-58"><a href="#cb92-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-59"><a href="#cb92-59" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; install.packages("tidyverse")</span></span>
<span id="cb92-60"><a href="#cb92-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-61"><a href="#cb92-61" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load Package</span></span>
<span id="cb92-62"><a href="#cb92-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-65"><a href="#cb92-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-66"><a href="#cb92-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "Load tidyverse" </span></span>
<span id="cb92-67"><a href="#cb92-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-68"><a href="#cb92-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-69"><a href="#cb92-69" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb92-70"><a href="#cb92-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-71"><a href="#cb92-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-72"><a href="#cb92-72" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data</span></span>
<span id="cb92-73"><a href="#cb92-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-74"><a href="#cb92-74" aria-hidden="true" tabindex="-1"></a>In this exercise we will use following CSV files:</span>
<span id="cb92-75"><a href="#cb92-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-76"><a href="#cb92-76" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="co">[</span><span class="ot">usa_division.csv</span><span class="co">](https://www.dropbox.com/s/w3it6xg8cji18x6/usa_division.csv?dl=0)</span>: USA division names with IDs</span>
<span id="cb92-77"><a href="#cb92-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-78"><a href="#cb92-78" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="co">[</span><span class="ot">usa_state.csv</span><span class="co">](https://www.dropbox.com/s/s2xdkji4eyknmoz/usa_state.csv?dl=0)</span>: USA State names with ID and division ID.  </span>
<span id="cb92-79"><a href="#cb92-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-80"><a href="#cb92-80" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="co">[</span><span class="ot">usa_corn_production.csv</span><span class="co">](https://www.dropbox.com/s/9al1v7faxy8w092/usa_corn_production.csv?dl=0)</span> USA grain crop production by state from 2012-2022</span>
<span id="cb92-81"><a href="#cb92-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-82"><a href="#cb92-82" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span><span class="co">[</span><span class="ot">gp_soil_data.csv</span><span class="co">](https://www.dropbox.com/s/9ikm5yct36oflei/gp_soil_data.csv?dl=0)</span>: Soil carbon with co-variate from four states in the Greatplain region in the USA</span>
<span id="cb92-83"><a href="#cb92-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-84"><a href="#cb92-84" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span><span class="co">[</span><span class="ot">usa_geochemical_raw.csv</span><span class="co">](https://www.dropbox.com/s/db4lxfvb40rx4sx/usa_geochemical_raw.csv?dl=0)</span>: Soil geochemical data for the USA, but cleaned</span>
<span id="cb92-85"><a href="#cb92-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-86"><a href="#cb92-86" aria-hidden="true" tabindex="-1"></a>We will use **read_csv()** function of **readr** package to import data as a **Tidy** data.</span>
<span id="cb92-87"><a href="#cb92-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-90"><a href="#cb92-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-91"><a href="#cb92-91" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "Load Data" </span></span>
<span id="cb92-92"><a href="#cb92-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-93"><a href="#cb92-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-94"><a href="#cb92-94" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb92-95"><a href="#cb92-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data folder</span></span>
<span id="cb92-96"><a href="#cb92-96" aria-hidden="true" tabindex="-1"></a>dataFolder<span class="ot">&lt;-</span><span class="st">"E:/Dropbox/GitHub/Data/USA/"</span></span>
<span id="cb92-97"><a href="#cb92-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb92-98"><a href="#cb92-98" aria-hidden="true" tabindex="-1"></a>div<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_division.csv"</span>))</span>
<span id="cb92-99"><a href="#cb92-99" aria-hidden="true" tabindex="-1"></a>state<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_state.csv"</span>))</span>
<span id="cb92-100"><a href="#cb92-100" aria-hidden="true" tabindex="-1"></a>corn<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"usa_corn_production.csv"</span>))</span>
<span id="cb92-101"><a href="#cb92-101" aria-hidden="true" tabindex="-1"></a>soil<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder, <span class="st">"gp_soil_data.csv"</span>))</span>
<span id="cb92-102"><a href="#cb92-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-103"><a href="#cb92-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-104"><a href="#cb92-104" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pipe Operator</span></span>
<span id="cb92-105"><a href="#cb92-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-106"><a href="#cb92-106" aria-hidden="true" tabindex="-1"></a>Before starting this tutorial, I like to brief you about the **Pipe Operator**. This is the most important operator for data wrangling in R. The pipe operator, written as **%\&gt;%**, has been a longstanding feature of the **magrittr** package for R. It takes the output of one function and passes it into another function as an argument. This allows us to link a sequence of analysis steps. In this tutorial, you can see exactly how this works in a real example. (Source:https://towardsdatascience.com/an-introduction-to-the-pipe-in-r-823090760d64)</span>
<span id="cb92-107"><a href="#cb92-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-108"><a href="#cb92-108" aria-hidden="true" tabindex="-1"></a><span class="fu">### Some Important Functions</span></span>
<span id="cb92-109"><a href="#cb92-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-110"><a href="#cb92-110" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Join</span></span>
<span id="cb92-111"><a href="#cb92-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-112"><a href="#cb92-112" aria-hidden="true" tabindex="-1"></a>In R we use **base::merge()** function to merge two dataframes. This function is present inside **join()** function of dplyr package. The most important condition for joining two dataframes is that the column type should be the same of "key" variable by the merging happens. Types of **base::merge()** and several **join()** function of dplyr available in R are:</span>
<span id="cb92-113"><a href="#cb92-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-114"><a href="#cb92-114" aria-hidden="true" tabindex="-1"></a><span class="al">![Join function of dplyr](Image/join_functions.png)</span>{fig-dplyr_join}</span>
<span id="cb92-115"><a href="#cb92-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-116"><a href="#cb92-116" aria-hidden="true" tabindex="-1"></a>**inner_join()** is a function in the **dplyr** library that performs an inner join on two data frames. An inner join returns only the rows that have matching values in both data frames. If there is no match in one of the data frames for a row in the other data frame, the result will not contain that row.</span>
<span id="cb92-117"><a href="#cb92-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-118"><a href="#cb92-118" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; inner_join(x, y, .....)</span></span>
<span id="cb92-119"><a href="#cb92-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-120"><a href="#cb92-120" aria-hidden="true" tabindex="-1"></a>We will join state, division and USA corn production data one by one e using *inner_join*()<span class="sc">\*</span> function;</span>
<span id="cb92-121"><a href="#cb92-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-124"><a href="#cb92-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-125"><a href="#cb92-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "inner_join-1" </span></span>
<span id="cb92-126"><a href="#cb92-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-127"><a href="#cb92-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-128"><a href="#cb92-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-129"><a href="#cb92-129" aria-hidden="true" tabindex="-1"></a>corn_state <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) </span>
<span id="cb92-130"><a href="#cb92-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-131"><a href="#cb92-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-134"><a href="#cb92-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-135"><a href="#cb92-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "inner_join-2" </span></span>
<span id="cb92-136"><a href="#cb92-136" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-137"><a href="#cb92-137" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-138"><a href="#cb92-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-139"><a href="#cb92-139" aria-hidden="true" tabindex="-1"></a>corn_state_div <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn_state, div)  </span>
<span id="cb92-140"><a href="#cb92-140" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-141"><a href="#cb92-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-142"><a href="#cb92-142" aria-hidden="true" tabindex="-1"></a>We can run multiple **inner_join()** functions in a series with pipe **%\&gt;%** function:</span>
<span id="cb92-143"><a href="#cb92-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-146"><a href="#cb92-146" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-147"><a href="#cb92-147" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "inner_join with pipe" </span></span>
<span id="cb92-148"><a href="#cb92-148" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-149"><a href="#cb92-149" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-150"><a href="#cb92-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-151"><a href="#cb92-151" aria-hidden="true" tabindex="-1"></a>mf.usa <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) <span class="sc">%&gt;%</span> </span>
<span id="cb92-152"><a href="#cb92-152" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">inner_join</span>(div) <span class="sc">%&gt;%</span></span>
<span id="cb92-153"><a href="#cb92-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb92-154"><a href="#cb92-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-155"><a href="#cb92-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-156"><a href="#cb92-156" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Relocate</span></span>
<span id="cb92-157"><a href="#cb92-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-158"><a href="#cb92-158" aria-hidden="true" tabindex="-1"></a>Now we will will organize DIVISION_FIPS, DIVISION_NAME, STATE_FIPS, STATE_NAME, DIVISION_NAME, YEAR, MT will use **relocate()** function:</span>
<span id="cb92-159"><a href="#cb92-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-160"><a href="#cb92-160" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; relocate(.data, ..., .before = NULL, .after = NULL)</span></span>
<span id="cb92-161"><a href="#cb92-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-162"><a href="#cb92-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-165"><a href="#cb92-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-166"><a href="#cb92-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "relocate()" </span></span>
<span id="cb92-167"><a href="#cb92-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-168"><a href="#cb92-168" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-169"><a href="#cb92-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-170"><a href="#cb92-170" aria-hidden="true" tabindex="-1"></a>mf.usa<span class="ot">&lt;-</span>dplyr<span class="sc">::</span><span class="fu">relocate</span>(mf.usa, DIVISION_ID, DIVISION_NAME, STATE_ID,   STATE_NAME, YEAR, MT,  </span>
<span id="cb92-171"><a href="#cb92-171" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.after =</span>  DIVISION_ID) </span>
<span id="cb92-172"><a href="#cb92-172" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mf.usa)</span>
<span id="cb92-173"><a href="#cb92-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-174"><a href="#cb92-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-175"><a href="#cb92-175" aria-hidden="true" tabindex="-1"></a>Now explore regions names with **levels()**</span>
<span id="cb92-176"><a href="#cb92-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-179"><a href="#cb92-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-180"><a href="#cb92-180" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mf.usa<span class="sc">$</span>DIVISION_NAME))</span>
<span id="cb92-181"><a href="#cb92-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-182"><a href="#cb92-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-183"><a href="#cb92-183" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Rename</span></span>
<span id="cb92-184"><a href="#cb92-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-185"><a href="#cb92-185" aria-hidden="true" tabindex="-1"></a>The **rename()** function can be used to rename variables. We will rename STAT_ID to SATE_FIPS.</span>
<span id="cb92-186"><a href="#cb92-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-187"><a href="#cb92-187" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; rename_with(.data, ... .cols = ...)</span></span>
<span id="cb92-188"><a href="#cb92-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-189"><a href="#cb92-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-192"><a href="#cb92-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-193"><a href="#cb92-193" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "rename()" </span></span>
<span id="cb92-194"><a href="#cb92-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-195"><a href="#cb92-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-196"><a href="#cb92-196" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb92-197"><a href="#cb92-197" aria-hidden="true" tabindex="-1"></a>df.usa <span class="ot">&lt;-</span> mf.usa <span class="sc">%&gt;%</span> </span>
<span id="cb92-198"><a href="#cb92-198" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"STATE_FIPS"</span> <span class="ot">=</span> <span class="st">"STATE_ID"</span>)</span>
<span id="cb92-199"><a href="#cb92-199" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df.usa)</span>
<span id="cb92-200"><a href="#cb92-200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-201"><a href="#cb92-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-202"><a href="#cb92-202" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pipe Join, Relocate and Rename functions</span></span>
<span id="cb92-203"><a href="#cb92-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-204"><a href="#cb92-204" aria-hidden="true" tabindex="-1"></a>We can also all together inner_join(), relocate(), and rename() in a single line with pipe:</span>
<span id="cb92-205"><a href="#cb92-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-208"><a href="#cb92-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-209"><a href="#cb92-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "inner_join, relocate, rename()" </span></span>
<span id="cb92-210"><a href="#cb92-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-211"><a href="#cb92-211" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-212"><a href="#cb92-212" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb92-213"><a href="#cb92-213" aria-hidden="true" tabindex="-1"></a>df.corn <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(corn, state) <span class="sc">%&gt;%</span> </span>
<span id="cb92-214"><a href="#cb92-214" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">inner_join</span>(div) <span class="sc">%&gt;%</span></span>
<span id="cb92-215"><a href="#cb92-215" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">relocate</span>(DIVISION_ID, DIVISION_NAME, STATE_ID,   STATE_NAME, YEAR, MT,  </span>
<span id="cb92-216"><a href="#cb92-216" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.after =</span>  DIVISION_ID) <span class="sc">%&gt;%</span></span>
<span id="cb92-217"><a href="#cb92-217" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"STATE_FIPS"</span> <span class="ot">=</span> <span class="st">"STATE_ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-218"><a href="#cb92-218" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glimpse</span>()</span>
<span id="cb92-219"><a href="#cb92-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-220"><a href="#cb92-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-221"><a href="#cb92-221" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Select</span></span>
<span id="cb92-222"><a href="#cb92-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-223"><a href="#cb92-223" aria-hidden="true" tabindex="-1"></a>**dplyr::select()** is used to extract a subset of columns from a data frame. It selects specific columns by name or by position. It is part of the dplyr package, which provides a set of functions that perform common data manipulation tasks efficiently and effectively.</span>
<span id="cb92-224"><a href="#cb92-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-225"><a href="#cb92-225" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; select(.data, ...)</span></span>
<span id="cb92-226"><a href="#cb92-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-227"><a href="#cb92-227" aria-hidden="true" tabindex="-1"></a>Now we will use select() to create a dataframe with state names, year and production</span>
<span id="cb92-228"><a href="#cb92-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-231"><a href="#cb92-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-232"><a href="#cb92-232" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-233"><a href="#cb92-233" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-234"><a href="#cb92-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-235"><a href="#cb92-235" aria-hidden="true" tabindex="-1"></a>df.state <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-236"><a href="#cb92-236" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span>(STATE_NAME, YEAR,  MT,) <span class="sc">%&gt;%</span></span>
<span id="cb92-237"><a href="#cb92-237" aria-hidden="true" tabindex="-1"></a>           <span class="fu">glimpse</span>()</span>
<span id="cb92-238"><a href="#cb92-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-239"><a href="#cb92-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-240"><a href="#cb92-240" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Filter</span></span>
<span id="cb92-241"><a href="#cb92-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-242"><a href="#cb92-242" aria-hidden="true" tabindex="-1"></a>The **filter()** function in **dplyr** is used to subset a data frame based on some condition(s) specified in the filter argument. The syntax for using filter is:</span>
<span id="cb92-243"><a href="#cb92-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-244"><a href="#cb92-244" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; filter(df, condition1, condition2, ...)</span></span>
<span id="cb92-245"><a href="#cb92-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-246"><a href="#cb92-246" aria-hidden="true" tabindex="-1"></a>We will use **filter()** to extract data only for northeast regions (single criteria) from us.df. This code will return a filtered data frame containing only the rows where the DIVISION_NAME column is equal to "East North Central".</span>
<span id="cb92-247"><a href="#cb92-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-250"><a href="#cb92-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-251"><a href="#cb92-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-252"><a href="#cb92-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-253"><a href="#cb92-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-254"><a href="#cb92-254" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.01</span><span class="ot">&lt;-</span>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-255"><a href="#cb92-255" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"East North Central"</span>)</span>
<span id="cb92-256"><a href="#cb92-256" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.01</span><span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-257"><a href="#cb92-257" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-258"><a href="#cb92-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-259"><a href="#cb92-259" aria-hidden="true" tabindex="-1"></a>Filtering by multiple criteria within a single logical expression - select data from East North Central, South Central and Middle Atlantic Division</span>
<span id="cb92-260"><a href="#cb92-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-263"><a href="#cb92-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-264"><a href="#cb92-264" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-265"><a href="#cb92-265" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-266"><a href="#cb92-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-267"><a href="#cb92-267" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.02</span><span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-268"><a href="#cb92-268" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">%in%</span><span class="fu">c</span>(<span class="st">"East North Central"</span>,<span class="st">"East South Central"</span>, <span class="st">"Middle Atlantic"</span>)) </span>
<span id="cb92-269"><a href="#cb92-269" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.02</span><span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-270"><a href="#cb92-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-271"><a href="#cb92-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-272"><a href="#cb92-272" aria-hidden="true" tabindex="-1"></a>or we can use **\|** which represents **OR** in the logical condition, any of the two conditions.</span>
<span id="cb92-273"><a href="#cb92-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-276"><a href="#cb92-276" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-277"><a href="#cb92-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-278"><a href="#cb92-278" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-279"><a href="#cb92-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-280"><a href="#cb92-280" aria-hidden="true" tabindex="-1"></a>df<span class="fl">.03</span><span class="ot">&lt;-</span> df.usa <span class="sc">%&gt;%</span> </span>
<span id="cb92-281"><a href="#cb92-281" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"East North Central"</span> <span class="sc">|</span> DIVISION_NAME <span class="sc">==</span> <span class="st">"Middle Atlantic"</span>)</span>
<span id="cb92-282"><a href="#cb92-282" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(df<span class="fl">.03</span><span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-283"><a href="#cb92-283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-284"><a href="#cb92-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-285"><a href="#cb92-285" aria-hidden="true" tabindex="-1"></a>Following filter create a files for the Middle Atlantic Division only with New York state.</span>
<span id="cb92-286"><a href="#cb92-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-289"><a href="#cb92-289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-290"><a href="#cb92-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-291"><a href="#cb92-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-292"><a href="#cb92-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-293"><a href="#cb92-293" aria-hidden="true" tabindex="-1"></a>df.ny<span class="ot">&lt;-</span>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-294"><a href="#cb92-294" aria-hidden="true" tabindex="-1"></a>         dplyr<span class="sc">::</span><span class="fu">filter</span>(DIVISION_NAME <span class="sc">==</span> <span class="st">"Middle Atlantic"</span> <span class="sc">&amp;</span> STATE_NAME <span class="sc">==</span> <span class="st">"New York"</span>)</span>
<span id="cb92-295"><a href="#cb92-295" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df.ny)</span>
<span id="cb92-296"><a href="#cb92-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-297"><a href="#cb92-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-298"><a href="#cb92-298" aria-hidden="true" tabindex="-1"></a>Following filters will select State where corn production (MT) is greater than the global average of production</span>
<span id="cb92-299"><a href="#cb92-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-302"><a href="#cb92-302" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-303"><a href="#cb92-303" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-304"><a href="#cb92-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-305"><a href="#cb92-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-306"><a href="#cb92-306" aria-hidden="true" tabindex="-1"></a>mean.prod <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-307"><a href="#cb92-307" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(MT <span class="sc">&gt;</span> <span class="fu">mean</span>(MT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-308"><a href="#cb92-308" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mean.prod<span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-309"><a href="#cb92-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-310"><a href="#cb92-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-311"><a href="#cb92-311" aria-hidden="true" tabindex="-1"></a>We use will **&amp;** in the following filters to select states or rows where <span class="in">`MT`</span> is greater than the global average of for the year 2017</span>
<span id="cb92-312"><a href="#cb92-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-315"><a href="#cb92-315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-316"><a href="#cb92-316" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-317"><a href="#cb92-317" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-318"><a href="#cb92-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-319"><a href="#cb92-319" aria-hidden="true" tabindex="-1"></a>mean.prod<span class="fl">.2017</span> <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-320"><a href="#cb92-320" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">filter</span>(MT <span class="sc">&gt;</span> <span class="fu">mean</span>(MT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span> YEAR <span class="sc">==</span><span class="dv">2017</span>)</span>
<span id="cb92-321"><a href="#cb92-321" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(mean.prod<span class="fl">.2017</span><span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-322"><a href="#cb92-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-323"><a href="#cb92-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-324"><a href="#cb92-324" aria-hidden="true" tabindex="-1"></a>Following command will select counties starting with "A". filter() with **grepl()** is used to search for pattern matching.</span>
<span id="cb92-325"><a href="#cb92-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-328"><a href="#cb92-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-329"><a href="#cb92-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-330"><a href="#cb92-330" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-331"><a href="#cb92-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-332"><a href="#cb92-332" aria-hidden="true" tabindex="-1"></a>state.a <span class="ot">&lt;-</span> df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-333"><a href="#cb92-333" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"^A"</span>, STATE_NAME))</span>
<span id="cb92-334"><a href="#cb92-334" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(<span class="fu">as.factor</span>(state.a <span class="sc">$</span>STATE_NAME))</span>
<span id="cb92-335"><a href="#cb92-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-336"><a href="#cb92-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-337"><a href="#cb92-337" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Summarize</span></span>
<span id="cb92-338"><a href="#cb92-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-339"><a href="#cb92-339" aria-hidden="true" tabindex="-1"></a>**Summarize** is a function in the dplyr used to collapse multiple values in a data frame into a single summary value. The function takes a data frame as input and returns a smaller data frame with summary statistics, such as mean, sum, count, etc. It can be used with other dplyr functions to manipulate and analyze data.</span>
<span id="cb92-340"><a href="#cb92-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-341"><a href="#cb92-341" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; summarise(.data, ..., .groups = NULL)</span></span>
<span id="cb92-342"><a href="#cb92-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-343"><a href="#cb92-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-344"><a href="#cb92-344" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Center**: mean(), median()</span>
<span id="cb92-345"><a href="#cb92-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-346"><a href="#cb92-346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Spread**: sd(), IQR(), mad()</span>
<span id="cb92-347"><a href="#cb92-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-348"><a href="#cb92-348" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Range**: min(), max(), quantile()</span>
<span id="cb92-349"><a href="#cb92-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-350"><a href="#cb92-350" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Position**: first(), last(), nth(),</span>
<span id="cb92-351"><a href="#cb92-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-352"><a href="#cb92-352" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Count**: n(), n_distinct()</span>
<span id="cb92-353"><a href="#cb92-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-354"><a href="#cb92-354" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Logical**: any(), all()</span>
<span id="cb92-355"><a href="#cb92-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-356"><a href="#cb92-356" aria-hidden="true" tabindex="-1"></a>**summarise()** and **summarize()** are synonyms.</span>
<span id="cb92-357"><a href="#cb92-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-360"><a href="#cb92-360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-361"><a href="#cb92-361" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-362"><a href="#cb92-362" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-363"><a href="#cb92-363" aria-hidden="true" tabindex="-1"></a><span class="co"># mean</span></span>
<span id="cb92-364"><a href="#cb92-364" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(df.corn, <span class="at">Mean=</span><span class="fu">mean</span>(MT))</span>
<span id="cb92-365"><a href="#cb92-365" aria-hidden="true" tabindex="-1"></a><span class="co"># median</span></span>
<span id="cb92-366"><a href="#cb92-366" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(df.corn, <span class="at">Median=</span><span class="fu">median</span>(MT))</span>
<span id="cb92-367"><a href="#cb92-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-368"><a href="#cb92-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-369"><a href="#cb92-369" aria-hidden="true" tabindex="-1"></a>The scoped variants (_if, _at, _all) of summarise() make it easy to apply the same transformation to multiple variables. There are three variants.</span>
<span id="cb92-370"><a href="#cb92-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-371"><a href="#cb92-371" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>summarise_at() affects variables selected with a character vector or vars()</span>
<span id="cb92-372"><a href="#cb92-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-373"><a href="#cb92-373" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>summarise_all() affects every variable</span>
<span id="cb92-374"><a href="#cb92-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-375"><a href="#cb92-375" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>summarise_if() affects variables selected with a predicate function</span>
<span id="cb92-376"><a href="#cb92-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-377"><a href="#cb92-377" aria-hidden="true" tabindex="-1"></a>Following **summarise_at()** function mean of SOC from USA soil data (soil).</span>
<span id="cb92-378"><a href="#cb92-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-381"><a href="#cb92-381" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-382"><a href="#cb92-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-383"><a href="#cb92-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-384"><a href="#cb92-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-385"><a href="#cb92-385" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb92-386"><a href="#cb92-386" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_at</span>(<span class="st">"SOC"</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-387"><a href="#cb92-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-388"><a href="#cb92-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-389"><a href="#cb92-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-390"><a href="#cb92-390" aria-hidden="true" tabindex="-1"></a>For multiple variables:</span>
<span id="cb92-391"><a href="#cb92-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-394"><a href="#cb92-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-395"><a href="#cb92-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-396"><a href="#cb92-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-397"><a href="#cb92-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-398"><a href="#cb92-398" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb92-399"><a href="#cb92-399" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_at</span>(<span class="fu">c</span>(<span class="st">"SOC"</span>, <span class="st">"NDVI"</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-400"><a href="#cb92-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-401"><a href="#cb92-401" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-402"><a href="#cb92-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-403"><a href="#cb92-403" aria-hidden="true" tabindex="-1"></a>The **summarise_if()** variants apply a predicate function (a function that returns TRUE or FALSE) to determine the relevant subset of columns.</span>
<span id="cb92-404"><a href="#cb92-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-405"><a href="#cb92-405" aria-hidden="true" tabindex="-1"></a>Here we apply mean() to the numeric columns:</span>
<span id="cb92-406"><a href="#cb92-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-409"><a href="#cb92-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-410"><a href="#cb92-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-411"><a href="#cb92-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-412"><a href="#cb92-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-413"><a href="#cb92-413" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb92-414"><a href="#cb92-414" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_if</span>(is.numeric, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-415"><a href="#cb92-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-416"><a href="#cb92-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-419"><a href="#cb92-419" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-420"><a href="#cb92-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-421"><a href="#cb92-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-422"><a href="#cb92-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-423"><a href="#cb92-423" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb92-424"><a href="#cb92-424" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb92-425"><a href="#cb92-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-426"><a href="#cb92-426" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-427"><a href="#cb92-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-428"><a href="#cb92-428" aria-hidden="true" tabindex="-1"></a>It is better to select first our target numerical columns and then apply **summarise_all()**:</span>
<span id="cb92-429"><a href="#cb92-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-432"><a href="#cb92-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-433"><a href="#cb92-433" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-434"><a href="#cb92-434" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-435"><a href="#cb92-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-436"><a href="#cb92-436" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span></span>
<span id="cb92-437"><a href="#cb92-437" aria-hidden="true" tabindex="-1"></a>    <span class="co"># First select  numerical columns</span></span>
<span id="cb92-438"><a href="#cb92-438" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(SOC, DEM, NDVI, MAP, MAT) <span class="sc">%&gt;%</span></span>
<span id="cb92-439"><a href="#cb92-439" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get mean of all these variables</span></span>
<span id="cb92-440"><a href="#cb92-440" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise_all</span>(mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb92-441"><a href="#cb92-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-442"><a href="#cb92-442" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-443"><a href="#cb92-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-444"><a href="#cb92-444" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mutate</span></span>
<span id="cb92-445"><a href="#cb92-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-446"><a href="#cb92-446" aria-hidden="true" tabindex="-1"></a>***mutate()** adds new columns to a data frame based on existing columns or variables. The new columns are specified by expressions that use the values from one or more existing columns. The function returns a new data frame with the added columns and the same number of rows as the original data frame.</span>
<span id="cb92-447"><a href="#cb92-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-448"><a href="#cb92-448" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; mutate(.data, ..., .dots = NULL)</span></span>
<span id="cb92-449"><a href="#cb92-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-450"><a href="#cb92-450" aria-hidden="true" tabindex="-1"></a>In this exercise we will create a new column (MT_1000) in df.corn dataframe dividing MT column by 1000</span>
<span id="cb92-451"><a href="#cb92-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-454"><a href="#cb92-454" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-455"><a href="#cb92-455" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-456"><a href="#cb92-456" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-457"><a href="#cb92-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-458"><a href="#cb92-458" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span></span>
<span id="cb92-459"><a href="#cb92-459" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get mean of all these variables</span></span>
<span id="cb92-460"><a href="#cb92-460" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">MT_1000 =</span> MT <span class="sc">/</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-461"><a href="#cb92-461" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span>
<span id="cb92-462"><a href="#cb92-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-463"><a href="#cb92-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-464"><a href="#cb92-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-465"><a href="#cb92-465" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Group by</span></span>
<span id="cb92-466"><a href="#cb92-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-467"><a href="#cb92-467" aria-hidden="true" tabindex="-1"></a>**group_by()** allows you to group a data frame by one or multiple variables. After grouping, you can perform operations on the grouped data, such as aggregating with **summarize()**, transforming with **mutate()**, or filtering with **filter()**. The result of grouping is a grouped tibble, which is a data structure that retains the grouping structure and allows you to perform further operations on the grouped data.</span>
<span id="cb92-468"><a href="#cb92-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-469"><a href="#cb92-469" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; group_by(.data, ..., )</span></span>
<span id="cb92-470"><a href="#cb92-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-471"><a href="#cb92-471" aria-hidden="true" tabindex="-1"></a>We can calculate global mean of USA corn production by division:</span>
<span id="cb92-472"><a href="#cb92-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-475"><a href="#cb92-475" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-476"><a href="#cb92-476" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-477"><a href="#cb92-477" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-478"><a href="#cb92-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-479"><a href="#cb92-479" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-480"><a href="#cb92-480" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(DIVISION_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb92-481"><a href="#cb92-481" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Prod_MT =</span> <span class="fu">mean</span>(MT)) </span>
<span id="cb92-482"><a href="#cb92-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-483"><a href="#cb92-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-484"><a href="#cb92-484" aria-hidden="true" tabindex="-1"></a>We can also apply the **group_by()**, **summarize()** and **mutate()** functions with pipe to calculate mean of corn production in 1000 MT by division for the year 2022</span>
<span id="cb92-485"><a href="#cb92-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-488"><a href="#cb92-488" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-489"><a href="#cb92-489" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-490"><a href="#cb92-490" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-491"><a href="#cb92-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-492"><a href="#cb92-492" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-493"><a href="#cb92-493" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(YEAR<span class="sc">==</span><span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-494"><a href="#cb92-494" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">group_by</span>(DIVISION_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb92-495"><a href="#cb92-495" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Prod_MT =</span> <span class="fu">mean</span>(MT)) <span class="sc">%&gt;%</span></span>
<span id="cb92-496"><a href="#cb92-496" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Prod_1000_MT =</span> Prod_MT <span class="sc">/</span> <span class="dv">1000</span>) </span>
<span id="cb92-497"><a href="#cb92-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-498"><a href="#cb92-498" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-499"><a href="#cb92-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-500"><a href="#cb92-500" aria-hidden="true" tabindex="-1"></a>We can also apply the group_by() and summarize() functions to calculate statistic of multiple variable:</span>
<span id="cb92-501"><a href="#cb92-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-504"><a href="#cb92-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-505"><a href="#cb92-505" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-506"><a href="#cb92-506" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-507"><a href="#cb92-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-508"><a href="#cb92-508" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span> </span>
<span id="cb92-509"><a href="#cb92-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(STATE) <span class="sc">%&gt;%</span></span>
<span id="cb92-510"><a href="#cb92-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">SOC =</span> <span class="fu">mean</span>(SOC),</span>
<span id="cb92-511"><a href="#cb92-511" aria-hidden="true" tabindex="-1"></a>            <span class="at">NDVI =</span> <span class="fu">mean</span>(NDVI),</span>
<span id="cb92-512"><a href="#cb92-512" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAP =</span> <span class="fu">mean</span>(MAP),</span>
<span id="cb92-513"><a href="#cb92-513" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAT =</span> <span class="fu">mean</span>(MAT))</span>
<span id="cb92-514"><a href="#cb92-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-515"><a href="#cb92-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-516"><a href="#cb92-516" aria-hidden="true" tabindex="-1"></a>Following code will idenfify State where corn production data has not reported for the all years.</span>
<span id="cb92-517"><a href="#cb92-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-520"><a href="#cb92-520" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-521"><a href="#cb92-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-522"><a href="#cb92-522" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-523"><a href="#cb92-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-524"><a href="#cb92-524" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-525"><a href="#cb92-525" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(STATE_NAME) <span class="sc">%&gt;%</span> </span>
<span id="cb92-526"><a href="#cb92-526" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb92-527"><a href="#cb92-527" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(n <span class="sc">&lt;</span> <span class="dv">11</span>) </span>
<span id="cb92-528"><a href="#cb92-528" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the state names</span></span>
<span id="cb92-529"><a href="#cb92-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-530"><a href="#cb92-530" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-531"><a href="#cb92-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-532"><a href="#cb92-532" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pivoting Data-frame</span></span>
<span id="cb92-533"><a href="#cb92-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-534"><a href="#cb92-534" aria-hidden="true" tabindex="-1"></a>Pivoting a data frame in R involves transforming columns into rows and vice versa. In R, there are multiple ways to pivot a data frame, but the most common methods are:</span>
<span id="cb92-535"><a href="#cb92-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-536"><a href="#cb92-536" aria-hidden="true" tabindex="-1"></a>**tidyr::pivot_wider**: The pivot_wider() function is used to reshape a data frame from a long format to a wide format, in which each row becomes a variable, and each column is an observation.</span>
<span id="cb92-537"><a href="#cb92-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-538"><a href="#cb92-538" aria-hidden="true" tabindex="-1"></a>**tidyr::pivot_longer**: This is a relatively new function in the tidyr library that makes it easy to pivot a data frame from wide to long format. It is used to reshape a data frame from a wide format to a long format, in which each column becomes a variable, and each row is an observation.</span>
<span id="cb92-539"><a href="#cb92-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-540"><a href="#cb92-540" aria-hidden="true" tabindex="-1"></a>**tidyr::spread()**: This function is also used to pivot data from long to wide format. It creates new columns from the values of one column, based on the values of another column.</span>
<span id="cb92-541"><a href="#cb92-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-542"><a href="#cb92-542" aria-hidden="true" tabindex="-1"></a>**tidy::gather()** : This function is used to pivot data from wide to long format. It collects values of multiple columns into a single column, based on the values of another column.</span>
<span id="cb92-543"><a href="#cb92-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-544"><a href="#cb92-544" aria-hidden="true" tabindex="-1"></a><span class="fu">##### pivot_wider</span></span>
<span id="cb92-545"><a href="#cb92-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-546"><a href="#cb92-546" aria-hidden="true" tabindex="-1"></a>pivot_wider() convert a dataset wider by increasing the number of columns and decreasing the number of rows.</span>
<span id="cb92-547"><a href="#cb92-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-550"><a href="#cb92-550" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-551"><a href="#cb92-551" aria-hidden="true" tabindex="-1"></a><span class="co">#| title: "pivot_wider" </span></span>
<span id="cb92-552"><a href="#cb92-552" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-553"><a href="#cb92-553" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-554"><a href="#cb92-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-555"><a href="#cb92-555" aria-hidden="true" tabindex="-1"></a>corn.wider <span class="ot">=</span> df.corn  <span class="sc">%&gt;%</span> </span>
<span id="cb92-556"><a href="#cb92-556" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">select</span> (STATE_FIPS,STATE_NAME, YEAR, MT) <span class="sc">%&gt;%</span></span>
<span id="cb92-557"><a href="#cb92-557" aria-hidden="true" tabindex="-1"></a>           <span class="co"># Drop state where reporting years less than 11 </span></span>
<span id="cb92-558"><a href="#cb92-558" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">filter</span>(STATE_NAME<span class="sc">!=</span> <span class="st">'Connecticut'</span>, </span>
<span id="cb92-559"><a href="#cb92-559" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Maine'</span>,                        </span>
<span id="cb92-560"><a href="#cb92-560" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Massachusetts'</span>, </span>
<span id="cb92-561"><a href="#cb92-561" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Nevada'</span>,</span>
<span id="cb92-562"><a href="#cb92-562" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'New Hampshire'</span>, </span>
<span id="cb92-563"><a href="#cb92-563" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Rhode Island'</span>, </span>
<span id="cb92-564"><a href="#cb92-564" aria-hidden="true" tabindex="-1"></a>                        STATE_NAME<span class="sc">!=</span> <span class="st">'Vermont'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-565"><a href="#cb92-565" aria-hidden="true" tabindex="-1"></a>           tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> YEAR, <span class="at">values_from =</span> MT) <span class="sc">%&gt;%</span></span>
<span id="cb92-566"><a href="#cb92-566" aria-hidden="true" tabindex="-1"></a>           <span class="fu">glimpse</span>()</span>
<span id="cb92-567"><a href="#cb92-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-568"><a href="#cb92-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-569"><a href="#cb92-569" aria-hidden="true" tabindex="-1"></a><span class="fu">##### pivot_longer</span></span>
<span id="cb92-570"><a href="#cb92-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-571"><a href="#cb92-571" aria-hidden="true" tabindex="-1"></a>The pivot_longer() function can be used to pivot a data frame from a wide format to a long format.</span>
<span id="cb92-572"><a href="#cb92-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-575"><a href="#cb92-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-576"><a href="#cb92-576" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(corn.wider)</span>
<span id="cb92-577"><a href="#cb92-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-578"><a href="#cb92-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-581"><a href="#cb92-581" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-582"><a href="#cb92-582" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-583"><a href="#cb92-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-584"><a href="#cb92-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-585"><a href="#cb92-585" aria-hidden="true" tabindex="-1"></a>corn.longer<span class="ot">&lt;-</span> corn.wider <span class="sc">%&gt;%</span> </span>
<span id="cb92-586"><a href="#cb92-586" aria-hidden="true" tabindex="-1"></a>               tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols=</span> <span class="fu">c</span>(<span class="st">"2012"</span>, <span class="st">"2013"</span>, <span class="st">"2014"</span>, <span class="st">"2015"</span>, <span class="st">"2016"</span>, <span class="st">"2017"</span>,                                              <span class="st">"2018"</span>, <span class="st">"2019"</span>, <span class="st">"2020"</span>, <span class="st">"2021"</span>,  <span class="st">"2022"</span>),</span>
<span id="cb92-587"><a href="#cb92-587" aria-hidden="true" tabindex="-1"></a>                          <span class="at">names_to =</span> <span class="st">"YEAR"</span>, <span class="co"># column need to be wider</span></span>
<span id="cb92-588"><a href="#cb92-588" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_to =</span> <span class="st">"MT"</span>) <span class="co"># data</span></span>
<span id="cb92-589"><a href="#cb92-589" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(corn.longer)</span>
<span id="cb92-590"><a href="#cb92-590" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-591"><a href="#cb92-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-592"><a href="#cb92-592" aria-hidden="true" tabindex="-1"></a>Following command combined select(), rename(), summarize() and pivot_longer() the data:</span>
<span id="cb92-593"><a href="#cb92-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-596"><a href="#cb92-596" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-597"><a href="#cb92-597" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-598"><a href="#cb92-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-599"><a href="#cb92-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-600"><a href="#cb92-600" aria-hidden="true" tabindex="-1"></a>soil <span class="sc">%&gt;%</span> </span>
<span id="cb92-601"><a href="#cb92-601" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First select  numerical columns</span></span>
<span id="cb92-602"><a href="#cb92-602" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(SOC, DEM, NDVI, MAP, MAT) <span class="sc">%&gt;%</span></span>
<span id="cb92-603"><a href="#cb92-603" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get summary statistics</span></span>
<span id="cb92-604"><a href="#cb92-604" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise_all</span>(<span class="fu">funs</span>(<span class="at">min =</span> min, </span>
<span id="cb92-605"><a href="#cb92-605" aria-hidden="true" tabindex="-1"></a>                      <span class="at">q25 =</span> <span class="fu">quantile</span>(., <span class="fl">0.25</span>), </span>
<span id="cb92-606"><a href="#cb92-606" aria-hidden="true" tabindex="-1"></a>                      <span class="at">median =</span> median, </span>
<span id="cb92-607"><a href="#cb92-607" aria-hidden="true" tabindex="-1"></a>                      <span class="at">q75 =</span> <span class="fu">quantile</span>(., <span class="fl">0.75</span>), </span>
<span id="cb92-608"><a href="#cb92-608" aria-hidden="true" tabindex="-1"></a>                      <span class="at">max =</span> max,</span>
<span id="cb92-609"><a href="#cb92-609" aria-hidden="true" tabindex="-1"></a>                      <span class="at">mean =</span> mean, </span>
<span id="cb92-610"><a href="#cb92-610" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sd =</span> sd)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-611"><a href="#cb92-611" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a nice looking table</span></span>
<span id="cb92-612"><a href="#cb92-612" aria-hidden="true" tabindex="-1"></a>   tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_sep =</span> <span class="st">"_"</span>, <span class="at">names_to =</span> <span class="fu">c</span>( <span class="st">"variable"</span>, <span class="st">".value"</span>)) </span>
<span id="cb92-613"><a href="#cb92-613" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb92-614"><a href="#cb92-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-615"><a href="#cb92-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-616"><a href="#cb92-616" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Spread</span></span>
<span id="cb92-617"><a href="#cb92-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-618"><a href="#cb92-618" aria-hidden="true" tabindex="-1"></a>**dplyr::spread()** is equivalent to **tidyr::pivot_wider()**:</span>
<span id="cb92-619"><a href="#cb92-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-622"><a href="#cb92-622" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-623"><a href="#cb92-623" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-624"><a href="#cb92-624" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-625"><a href="#cb92-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-626"><a href="#cb92-626" aria-hidden="true" tabindex="-1"></a>df.corn <span class="sc">%&gt;%</span> </span>
<span id="cb92-627"><a href="#cb92-627" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span> (STATE_FIPS, YEAR, STATE_NAME, MT) <span class="sc">%&gt;%</span></span>
<span id="cb92-628"><a href="#cb92-628" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">spread</span>(YEAR, MT) </span>
<span id="cb92-629"><a href="#cb92-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-630"><a href="#cb92-630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-631"><a href="#cb92-631" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Gather</span></span>
<span id="cb92-632"><a href="#cb92-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-633"><a href="#cb92-633" aria-hidden="true" tabindex="-1"></a>**tidyr::gather("key", "value", x, y, z)** is equivalent to **tidyr::pivot_longer()**</span>
<span id="cb92-634"><a href="#cb92-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-637"><a href="#cb92-637" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-638"><a href="#cb92-638" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb92-639"><a href="#cb92-639" aria-hidden="true" tabindex="-1"></a><span class="co">#| error: false</span></span>
<span id="cb92-640"><a href="#cb92-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-641"><a href="#cb92-641" aria-hidden="true" tabindex="-1"></a>corr.gathered<span class="ot">&lt;-</span>corn.wider <span class="sc">%&gt;%</span></span>
<span id="cb92-642"><a href="#cb92-642" aria-hidden="true" tabindex="-1"></a>        tidyr<span class="sc">::</span><span class="fu">gather</span>(<span class="at">key =</span> YEAR, <span class="at">value =</span> MT, <span class="sc">-</span>STATE_FIPS, <span class="sc">-</span>STATE_NAME) <span class="sc">%&gt;%</span></span>
<span id="cb92-643"><a href="#cb92-643" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glimpse</span>()</span>
<span id="cb92-644"><a href="#cb92-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-645"><a href="#cb92-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-646"><a href="#cb92-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cleaning a messy data</span></span>
<span id="cb92-647"><a href="#cb92-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-648"><a href="#cb92-648" aria-hidden="true" tabindex="-1"></a>In this exercise you will learn how a clean data and make it ready for analysis, such as dealing with missing values, data with below detection limit and cleaning spatial characters. We will clean **usa_geochemical_raw.csv** data for further analysis. The data could be found <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.dropbox.com/sh/n1bxn0rmrabtcjn/AADvgwWvMFpNfwSPu0gbb17ja?dl=0)</span></span>
<span id="cb92-649"><a href="#cb92-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-650"><a href="#cb92-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb92-651"><a href="#cb92-651" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a data folder</span></span>
<span id="cb92-652"><a href="#cb92-652" aria-hidden="true" tabindex="-1"></a>dataFolder<span class="ot">&lt;-</span><span class="st">"E:/Dropbox/GitHub/Data/USA/"</span></span>
<span id="cb92-653"><a href="#cb92-653" aria-hidden="true" tabindex="-1"></a>df.geo<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder,<span class="st">"usa_geochemical_raw.csv"</span>))</span>
<span id="cb92-654"><a href="#cb92-654" aria-hidden="true" tabindex="-1"></a>meta.geo<span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="fu">paste0</span>(dataFolder,<span class="st">"usa_geochemical_meta_data.csv"</span>))</span>
<span id="cb92-655"><a href="#cb92-655" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-656"><a href="#cb92-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-659"><a href="#cb92-659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-660"><a href="#cb92-660" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df.geo)</span>
<span id="cb92-661"><a href="#cb92-661" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-662"><a href="#cb92-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-665"><a href="#cb92-665" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-666"><a href="#cb92-666" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(meta.geo)</span>
<span id="cb92-667"><a href="#cb92-667" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-668"><a href="#cb92-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-669"><a href="#cb92-669" aria-hidden="true" tabindex="-1"></a>We first create a file with limited number of variables using **select** functions and rename them:</span>
<span id="cb92-670"><a href="#cb92-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-673"><a href="#cb92-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-674"><a href="#cb92-674" aria-hidden="true" tabindex="-1"></a>mf.geo <span class="ot">&lt;-</span> df.geo <span class="sc">%&gt;%</span></span>
<span id="cb92-675"><a href="#cb92-675" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(A_LabID, StateID,  LandCover1, A_Depth, A_C_Tot, A_C_Inorg, A_C_Org, A_As, A_Cd,  A_Pb, A_Cr) <span class="sc">%&gt;%</span></span>
<span id="cb92-676"><a href="#cb92-676" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="st">"LAB_ID"</span><span class="ot">=</span>A_LabID,</span>
<span id="cb92-677"><a href="#cb92-677" aria-hidden="true" tabindex="-1"></a>             <span class="st">"LandCover"</span> <span class="ot">=</span>LandCover1,</span>
<span id="cb92-678"><a href="#cb92-678" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Soil_depth"</span> <span class="ot">=</span> A_Depth,</span>
<span id="cb92-679"><a href="#cb92-679" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Total_Carbon"</span> <span class="ot">=</span> A_C_Tot,</span>
<span id="cb92-680"><a href="#cb92-680" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Inorg_Carbon"</span> <span class="ot">=</span> A_C_Inorg,</span>
<span id="cb92-681"><a href="#cb92-681" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Organic_Carbon"</span><span class="ot">=</span> A_C_Org, </span>
<span id="cb92-682"><a href="#cb92-682" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Arsenic"</span> <span class="ot">=</span> A_As,</span>
<span id="cb92-683"><a href="#cb92-683" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Cadmium"</span> <span class="ot">=</span> A_Cd,</span>
<span id="cb92-684"><a href="#cb92-684" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Lead"</span> <span class="ot">=</span> A_Pb,</span>
<span id="cb92-685"><a href="#cb92-685" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Chromium"</span> <span class="ot">=</span> A_Cr) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb92-686"><a href="#cb92-686" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-687"><a href="#cb92-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-688"><a href="#cb92-688" aria-hidden="true" tabindex="-1"></a>Now, we filter the data where records have N.S. values INS:</span>
<span id="cb92-689"><a href="#cb92-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-692"><a href="#cb92-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-693"><a href="#cb92-693" aria-hidden="true" tabindex="-1"></a>mf.geo<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> </span>
<span id="cb92-694"><a href="#cb92-694" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(Soil_depth <span class="sc">!=</span> <span class="st">"N.S."</span> <span class="sc">&amp;</span> Total_Carbon <span class="sc">!=</span><span class="st">"INS"</span>)</span>
<span id="cb92-695"><a href="#cb92-695" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-696"><a href="#cb92-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-697"><a href="#cb92-697" aria-hidden="true" tabindex="-1"></a>Then, we will convert all N.D. values to empty string:</span>
<span id="cb92-698"><a href="#cb92-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-701"><a href="#cb92-701" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-702"><a href="#cb92-702" aria-hidden="true" tabindex="-1"></a>mf.geo[mf.geo<span class="sc">==</span><span class="st">"N.D."</span>]<span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb92-703"><a href="#cb92-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-704"><a href="#cb92-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-705"><a href="#cb92-705" aria-hidden="true" tabindex="-1"></a>Here detection limits of As, Cd, Pb and Cr are 0.6, 0.1, 0.5, and 1 mg/kg, respectively. We will replace the values below detection limits by half of detection limits of these heavy-metals. Before that we have to remove **"\&lt;"** and convert the all <span class="kw">&lt;chr&gt;</span> to <span class="kw">&lt;double&gt;</span>.</span>
<span id="cb92-706"><a href="#cb92-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-709"><a href="#cb92-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-710"><a href="#cb92-710" aria-hidden="true" tabindex="-1"></a>mf.geo <span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span></span>
<span id="cb92-711"><a href="#cb92-711" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"Arsenic"</span>, <span class="st">"Cadmium"</span>, <span class="st">"Lead"</span>, <span class="st">"Chromium"</span>), str_replace, <span class="st">"&lt;"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-712"><a href="#cb92-712" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">11</span>), as.numeric) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb92-713"><a href="#cb92-713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-714"><a href="#cb92-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-715"><a href="#cb92-715" aria-hidden="true" tabindex="-1"></a>Now replace values below detection limits:</span>
<span id="cb92-716"><a href="#cb92-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-719"><a href="#cb92-719" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-720"><a href="#cb92-720" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Arsenic"</span>][mf.geo[<span class="st">"Arsenic"</span>] <span class="sc">==</span> <span class="fl">0.6</span>] <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb92-721"><a href="#cb92-721" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Cadmium"</span>][mf.geo[<span class="st">"Cadmium"</span>] <span class="sc">==</span> <span class="fl">0.1</span>] <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb92-722"><a href="#cb92-722" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Lead"</span>][mf.geo[<span class="st">"Lead"</span>] <span class="sc">==</span> <span class="fl">0.5</span>] <span class="ot">&lt;-</span> <span class="fl">0.25</span></span>
<span id="cb92-723"><a href="#cb92-723" aria-hidden="true" tabindex="-1"></a>mf.geo[<span class="st">"Chromium"</span>][mf.geo[<span class="st">"Chromium"</span>] <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb92-724"><a href="#cb92-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-725"><a href="#cb92-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-726"><a href="#cb92-726" aria-hidden="true" tabindex="-1"></a>Now will check the missing values of the data:</span>
<span id="cb92-727"><a href="#cb92-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-730"><a href="#cb92-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-731"><a href="#cb92-731" aria-hidden="true" tabindex="-1"></a><span class="co"># counting unique, missing, and median values</span></span>
<span id="cb92-732"><a href="#cb92-732" aria-hidden="true" tabindex="-1"></a>Arsenic<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Arsenic),</span>
<span id="cb92-733"><a href="#cb92-733" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Arsenic)),</span>
<span id="cb92-734"><a href="#cb92-734" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Arsenic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-735"><a href="#cb92-735" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Arsenic, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-736"><a href="#cb92-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-737"><a href="#cb92-737" aria-hidden="true" tabindex="-1"></a>Cadmium<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Cadmium),</span>
<span id="cb92-738"><a href="#cb92-738" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Cadmium)),</span>
<span id="cb92-739"><a href="#cb92-739" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Cadmium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-740"><a href="#cb92-740" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Cadmium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-741"><a href="#cb92-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-742"><a href="#cb92-742" aria-hidden="true" tabindex="-1"></a>Lead<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Lead),</span>
<span id="cb92-743"><a href="#cb92-743" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Lead)),</span>
<span id="cb92-744"><a href="#cb92-744" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Lead, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-745"><a href="#cb92-745" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Lead, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-746"><a href="#cb92-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-747"><a href="#cb92-747" aria-hidden="true" tabindex="-1"></a>Chromium<span class="ot">&lt;-</span> mf.geo <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">N =</span> <span class="fu">length</span>(Chromium),</span>
<span id="cb92-748"><a href="#cb92-748" aria-hidden="true" tabindex="-1"></a>                 <span class="at">na =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Chromium)),</span>
<span id="cb92-749"><a href="#cb92-749" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Min =</span> <span class="fu">min</span>(Chromium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-750"><a href="#cb92-750" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Max =</span><span class="fu">max</span>(Chromium, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb92-751"><a href="#cb92-751" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb92-752"><a href="#cb92-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-753"><a href="#cb92-753" aria-hidden="true" tabindex="-1"></a><span class="co">#bind the data</span></span>
<span id="cb92-754"><a href="#cb92-754" aria-hidden="true" tabindex="-1"></a>geo.sum<span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(Arsenic, Cadmium, Lead, Chromium)</span>
<span id="cb92-755"><a href="#cb92-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-756"><a href="#cb92-756" aria-hidden="true" tabindex="-1"></a><span class="co">#add.row.names</span></span>
<span id="cb92-757"><a href="#cb92-757" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(geo.sum) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Arsenic"</span>, <span class="st">"Cadmium"</span>, <span class="st">"Lead"</span>, <span class="st">"Chromium"</span>)</span>
<span id="cb92-758"><a href="#cb92-758" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(geo.sum)</span>
<span id="cb92-759"><a href="#cb92-759" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-760"><a href="#cb92-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-761"><a href="#cb92-761" aria-hidden="true" tabindex="-1"></a>One of the common method of replacing missing values is **na.omit**. The function **na.omit()** returns the object with listwise deletion of missing values and function create new dataset without missing data.</span>
<span id="cb92-762"><a href="#cb92-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-765"><a href="#cb92-765" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-766"><a href="#cb92-766" aria-hidden="true" tabindex="-1"></a>newdata <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(mf.geo)</span>
<span id="cb92-767"><a href="#cb92-767" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(newdata)</span>
<span id="cb92-768"><a href="#cb92-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-769"><a href="#cb92-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-770"><a href="#cb92-770" aria-hidden="true" tabindex="-1"></a>This function delete all records with missing values. Now newdata have only 1,167 records, since Inorg_Carbon variable has 3,690 missing values which all are omitted.</span>
<span id="cb92-771"><a href="#cb92-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-772"><a href="#cb92-772" aria-hidden="true" tabindex="-1"></a>We can impute missing values in several ways. The easiest way to impute missing values is by replacing the mean values of the variable. The following code replace missing of Arsenic, Cadmium, Lead and Chromium with their mean values.</span>
<span id="cb92-773"><a href="#cb92-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-776"><a href="#cb92-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-777"><a href="#cb92-777" aria-hidden="true" tabindex="-1"></a>mf.geo.new<span class="ot">&lt;-</span>mf.geo <span class="sc">%&gt;%</span> <span class="fu">mutate_at</span>(<span class="fu">vars</span>(Arsenic, Cadmium, Lead, Chromium),<span class="sc">~</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x), <span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), .x)) <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb92-778"><a href="#cb92-778" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-779"><a href="#cb92-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-782"><a href="#cb92-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb92-783"><a href="#cb92-783" aria-hidden="true" tabindex="-1"></a>mf.geo.new <span class="sc">%&gt;%</span><span class="fu">summarise</span>(<span class="fu">sum</span>(<span class="fu">is.na</span>(Chromium)))</span>
<span id="cb92-784"><a href="#cb92-784" aria-hidden="true" tabindex="-1"></a><span class="co"># save clean data</span></span>
<span id="cb92-785"><a href="#cb92-785" aria-hidden="true" tabindex="-1"></a><span class="co">#write_csv(mf.geo.new,"usa_geochemical_clean.csv" )</span></span>
<span id="cb92-786"><a href="#cb92-786" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb92-787"><a href="#cb92-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-788"><a href="#cb92-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-789"><a href="#cb92-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise</span></span>
<span id="cb92-790"><a href="#cb92-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-791"><a href="#cb92-791" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Create a folder in your computer name Homework.</span>
<span id="cb92-792"><a href="#cb92-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-793"><a href="#cb92-793" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Create a R-Markdown Project on this Homework directory</span>
<span id="cb92-794"><a href="#cb92-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-795"><a href="#cb92-795" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Create a R-Markdown  documents (name homework_01.rmd) in this project directory and do all Tasks (1 to 23) using the data shown below. </span>
<span id="cb92-796"><a href="#cb92-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-797"><a href="#cb92-797" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Submit all codes and output  as a HTML document (homework_02.html) before class of next week.</span>
<span id="cb92-798"><a href="#cb92-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-799"><a href="#cb92-799" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Required R-Package</span></span>
<span id="cb92-800"><a href="#cb92-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-801"><a href="#cb92-801" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;library(tidyverse)</span></span>
<span id="cb92-802"><a href="#cb92-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-803"><a href="#cb92-803" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data</span></span>
<span id="cb92-804"><a href="#cb92-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-805"><a href="#cb92-805" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="co">[</span><span class="ot">bd_rice_production.csv</span><span class="co">](https://www.dropbox.com/s/civw156b81mhvm6/bd_rice_production.csv?dl=0)</span>: Yearly rice production of Bangladesh</span>
<span id="cb92-806"><a href="#cb92-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-807"><a href="#cb92-807" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="co">[</span><span class="ot">bd_district.csv</span><span class="co">](https://www.dropbox.com/s/jnaq80qq8rnxhp9/bd_district.csv?dl=0)</span>: District names with DISTRICT_ID and DIVISION_PCODE</span>
<span id="cb92-808"><a href="#cb92-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-809"><a href="#cb92-809" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span><span class="co">[</span><span class="ot">bd_division.csv</span><span class="co">](https://www.dropbox.com/s/iofedcoopx5tkwa/bd_division.csv?dl=0)</span> Division names and DIVISION_PCODE</span>
<span id="cb92-810"><a href="#cb92-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-811"><a href="#cb92-811" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="co">[</span><span class="ot">raj_soil_data.csv</span><span class="co">](https://www.dropbox.com/s/pdaclpszt9bto8b/raj_soil_data.csv?dl=0)</span>: SRDI soil data for Rajshahi Division</span>
<span id="cb92-812"><a href="#cb92-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-813"><a href="#cb92-813" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="co">[</span><span class="ot">bd_soil_data_raw.csv</span><span class="co">](https://www.dropbox.com/s/cc41v0an9ia5w52/bd_soil_data_raw.csv?dl=0)</span>: SRDI soil data, not cleaned</span>
<span id="cb92-814"><a href="#cb92-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-815"><a href="#cb92-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-816"><a href="#cb92-816" aria-hidden="true" tabindex="-1"></a>Download all above data and save in your project directory. Use read_csv to load the data in your R-session. For example:</span>
<span id="cb92-817"><a href="#cb92-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-818"><a href="#cb92-818" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; rice&lt;-read_csv("bd_rice_production.csv"))</span></span>
<span id="cb92-819"><a href="#cb92-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-820"><a href="#cb92-820" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Tasks</span></span>
<span id="cb92-821"><a href="#cb92-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-822"><a href="#cb92-822" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Join rice production, and district file using dplyr::inner_join()</span>
<span id="cb92-823"><a href="#cb92-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-824"><a href="#cb92-824" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Then join division file using dplyr::inner_join()</span>
<span id="cb92-825"><a href="#cb92-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-826"><a href="#cb92-826" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Organize column as (DIVISION_ID, DIVISION_NAME, DISTRICT_ID, DISTRICT_NAME, YEAR, MT using dplyr::relocate()</span>
<span id="cb92-827"><a href="#cb92-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-828"><a href="#cb92-828" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Rename "DISTRICT_ID" to "DISTRICT_PCODE" using dplyr::rename()</span>
<span id="cb92-829"><a href="#cb92-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-830"><a href="#cb92-830" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Run all the above code using pipe function in a single line and create a data frame name df.rice.csv</span>
<span id="cb92-831"><a href="#cb92-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-832"><a href="#cb92-832" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Form df.rice data that you have created before, use select() function to create a data frame only with DISTRICT_NAME, YEAR and MT</span>
<span id="cb92-833"><a href="#cb92-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-834"><a href="#cb92-834" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Filter out the data from Rajshahi division using dplyr::filter()</span>
<span id="cb92-835"><a href="#cb92-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-836"><a href="#cb92-836" aria-hidden="true" tabindex="-1"></a><span class="ss">8. </span>Filter (Filtering by multiple criteria) all district in Rajshahi and Dhaka divisions using dplyr::filter()</span>
<span id="cb92-837"><a href="#cb92-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-838"><a href="#cb92-838" aria-hidden="true" tabindex="-1"></a><span class="ss">9. </span>Use **\|** or **OR** in the logical condition in filter function, select data from any of the two divisions.</span>
<span id="cb92-839"><a href="#cb92-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-840"><a href="#cb92-840" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>Apply filter create a files for the Rajshai Division only with Bogra District.</span>
<span id="cb92-841"><a href="#cb92-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-842"><a href="#cb92-842" aria-hidden="true" tabindex="-1"></a><span class="ss">11. </span>Select districts where rice production (MT) is greater than the global average</span>
<span id="cb92-843"><a href="#cb92-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-844"><a href="#cb92-844" aria-hidden="true" tabindex="-1"></a><span class="ss">12. </span>Use **&amp;** to select district where <span class="in">`MT`</span> is greater than the global average of for the year 2018-2019</span>
<span id="cb92-845"><a href="#cb92-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-846"><a href="#cb92-846" aria-hidden="true" tabindex="-1"></a><span class="ss">13. </span>Select districts starting with "P"</span>
<span id="cb92-847"><a href="#cb92-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-848"><a href="#cb92-848" aria-hidden="true" tabindex="-1"></a><span class="ss">14. </span>Use raj_soil data to calculate mean of SOM using dplyr::summarise_at() function</span>
<span id="cb92-849"><a href="#cb92-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-850"><a href="#cb92-850" aria-hidden="true" tabindex="-1"></a><span class="ss">15. </span>Use bd_soil data to calculate mean of SOM and NDVI using dplyr::summarise_at() function</span>
<span id="cb92-851"><a href="#cb92-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-852"><a href="#cb92-852" aria-hidden="true" tabindex="-1"></a><span class="ss">16. </span>Use dplyr::summarise_if() to calculate mean() to the numeric columns</span>
<span id="cb92-853"><a href="#cb92-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-854"><a href="#cb92-854" aria-hidden="true" tabindex="-1"></a><span class="ss">17. </span>Select numerical columns (pH,SOM, DEM, NDVI, NDFI) and then apply dplyr::summarise_all()<span class="sc">\*</span>to calculate mean of these variables</span>
<span id="cb92-855"><a href="#cb92-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-856"><a href="#cb92-856" aria-hidden="true" tabindex="-1"></a><span class="ss">18. </span>Create a new column (MT_1000) in df.rice dataframe dividing MT column by 1000 using mutate()</span>
<span id="cb92-857"><a href="#cb92-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-858"><a href="#cb92-858" aria-hidden="true" tabindex="-1"></a><span class="ss">20. </span>Apply the group_by(), summarize()<span class="sc">\*\*</span> and mutate() functions with pipe to calculate mean of corn production in 1000 MT by division for the year 2018-2019</span>
<span id="cb92-859"><a href="#cb92-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-860"><a href="#cb92-860" aria-hidden="true" tabindex="-1"></a><span class="ss">21. </span>Use df.rice data to create a wider data frame using tidyr::pivot_wider() function</span>
<span id="cb92-861"><a href="#cb92-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-862"><a href="#cb92-862" aria-hidden="true" tabindex="-1"></a><span class="ss">22. </span>Convert rice.wider data to a longer format use tidyr::pivot_longer()</span>
<span id="cb92-863"><a href="#cb92-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-864"><a href="#cb92-864" aria-hidden="true" tabindex="-1"></a><span class="ss">23. </span>Clean bd_soil_data_raw.csv and save as bd_soil_data.final.csv. Follow the steps you have learned from "Cleaning a messy data" section. </span>
<span id="cb92-865"><a href="#cb92-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-866"><a href="#cb92-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-867"><a href="#cb92-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-868"><a href="#cb92-868" aria-hidden="true" tabindex="-1"></a><span class="fu">### Further Reading</span></span>
<span id="cb92-869"><a href="#cb92-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-870"><a href="#cb92-870" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="co">[</span><span class="ot">R for Data Science</span><span class="co">](https://r4ds.had.co.nz/)</span></span>
<span id="cb92-871"><a href="#cb92-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-872"><a href="#cb92-872" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span><span class="co">[</span><span class="ot">Data Wrangling with R</span><span class="co">](https://cengel.github.io/R-data-wrangling/)</span></span>
<span id="cb92-873"><a href="#cb92-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-874"><a href="#cb92-874" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span><span class="co">[</span><span class="ot">Book: Data Wrangling with R</span><span class="co">](https://link.springer.com/book/10.1007/978-3-319-45599-0)</span></span>
<span id="cb92-875"><a href="#cb92-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-876"><a href="#cb92-876" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span><span class="co">[</span><span class="ot">PDF Data wrangling with R and RStudio</span><span class="co">](https://github.com/rstudio/webinars/blob/master/05-Data-Wrangling-with-R-and-RStudio/wrangling-webinar.pdf)</span></span>
<span id="cb92-877"><a href="#cb92-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-878"><a href="#cb92-878" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span><span class="co">[</span><span class="ot">Youtube Data Wrangling with R and the Tidyverse - Workshop</span><span class="co">](https://www.youtube.com/watch?v=CnY5Y5ANnjE)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© CC-By Zia Ahmed, Unversity at Buffalo 2023</div>   
    <div class="nav-footer-right">This page is built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>